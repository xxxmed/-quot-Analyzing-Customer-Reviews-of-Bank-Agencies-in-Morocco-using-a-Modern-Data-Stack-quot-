[0m07:22:54.905966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff24f8a5550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25200fcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff24fad5d50>]}


============================== 07:22:54.910409 | d11ea48e-bd2d-4b7d-a8c8-742eddd9c4cd ==============================
[0m07:22:54.910409 [info ] [MainThread]: Running with dbt=1.9.4
[0m07:22:54.911264 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/zakaria/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt init', 'send_anonymous_usage_stats': 'True'}
[0m07:22:54.924613 [warn ] [MainThread]: [ConfigFolderDirectory]: Unable to parse logging event dictionary. Failed to parse dir field: expected string or bytes-like object, got 'PosixPath'.. Dictionary: {'dir': PosixPath('/home/zakaria/.dbt')}
[0m07:22:54.925317 [info ] [MainThread]: Creating dbt configuration folder at 
[0m07:23:01.535673 [debug] [MainThread]: Starter project path: /home/zakaria/python311-airflow/lib/python3.11/site-packages/dbt/include/starter_project
[0m07:23:01.539909 [info ] [MainThread]: 
Your new dbt project "etl_dw" was created!

For more information on how to configure the profiles.yml file,
please consult the dbt documentation here:

  https://docs.getdbt.com/docs/configure-your-profile

One more thing:

Need help? Don't hesitate to reach out to us via GitHub issues or on Slack:

  https://community.getdbt.com/

Happy modeling!

[0m07:23:01.540790 [info ] [MainThread]: Setting up your profile.
[0m07:23:53.444061 [info ] [MainThread]: Profile etl_dw written to /home/zakaria/.dbt/profiles.yml using target's profile_template.yml and your supplied values. Run 'dbt debug' to validate the connection.
[0m07:23:53.458414 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": true, "command_wall_clock_time": 58.641228, "process_in_blocks": "840", "process_kernel_time": 0.212599, "process_mem_max_rss": "104144", "process_out_blocks": "80", "process_user_time": 2.069837}
[0m07:23:53.460873 [debug] [MainThread]: Command `dbt init` succeeded at 07:23:53.460292 after 58.64 seconds
[0m07:23:53.463258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff253cc7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff253bffd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff253d64390>]}
[0m07:23:53.465223 [debug] [MainThread]: Flushing usage events
[0m07:23:54.460300 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:24:03.407201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f5bc05d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f5bc1390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f689c2d0>]}


============================== 07:24:03.411376 | f4364e8f-6ad2-4527-b7d9-765afda8870f ==============================
[0m07:24:03.411376 [info ] [MainThread]: Running with dbt=1.9.4
[0m07:24:03.412339 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/zakaria/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:24:03.423130 [info ] [MainThread]: dbt version: 1.9.4
[0m07:24:03.423887 [info ] [MainThread]: python version: 3.11.2
[0m07:24:03.424708 [info ] [MainThread]: python path: /home/zakaria/python311-airflow/bin/python3
[0m07:24:03.425452 [info ] [MainThread]: os info: Linux-6.1.0-35-amd64-x86_64-with-glibc2.36
[0m07:24:03.499908 [info ] [MainThread]: Using profiles dir at /home/zakaria/.dbt
[0m07:24:03.500606 [info ] [MainThread]: Using profiles.yml file at /home/zakaria/.dbt/profiles.yml
[0m07:24:03.501145 [info ] [MainThread]: Using dbt_project.yml file at /home/zakaria/projets/dw/DBT/dbt_project.yml
[0m07:24:03.501865 [info ] [MainThread]: adapter type: postgres
[0m07:24:03.502385 [info ] [MainThread]: adapter version: 1.9.0
[0m07:24:03.502918 [info ] [MainThread]: Configuration:
[0m07:24:03.503424 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:24:03.503924 [info ] [MainThread]:   dbt_project.yml file [[31mERROR not found[0m]
[0m07:24:03.504464 [info ] [MainThread]: Required dependencies:
[0m07:24:03.504995 [debug] [MainThread]: Executing "git --help"
[0m07:24:03.519213 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:24:03.520506 [debug] [MainThread]: STDERR: "b''"
[0m07:24:03.521204 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:24:03.522123 [info ] [MainThread]: Connection:
[0m07:24:03.522998 [info ] [MainThread]:   host: localhost
[0m07:24:03.523610 [info ] [MainThread]:   port: 5432
[0m07:24:03.524162 [info ] [MainThread]:   user: zakaria
[0m07:24:03.525053 [info ] [MainThread]:   database: bd_staging
[0m07:24:03.525903 [info ] [MainThread]:   schema: public
[0m07:24:03.526737 [info ] [MainThread]:   connect_timeout: 10
[0m07:24:03.527655 [info ] [MainThread]:   role: None
[0m07:24:03.528542 [info ] [MainThread]:   search_path: None
[0m07:24:03.529365 [info ] [MainThread]:   keepalives_idle: 0
[0m07:24:03.530104 [info ] [MainThread]:   sslmode: None
[0m07:24:03.530770 [info ] [MainThread]:   sslcert: None
[0m07:24:03.531376 [info ] [MainThread]:   sslkey: None
[0m07:24:03.531974 [info ] [MainThread]:   sslrootcert: None
[0m07:24:03.532567 [info ] [MainThread]:   application_name: dbt
[0m07:24:03.533093 [info ] [MainThread]:   retries: 1
[0m07:24:03.533815 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m07:24:03.614705 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m07:24:03.652398 [debug] [MainThread]: Using postgres connection "debug"
[0m07:24:03.653013 [debug] [MainThread]: On debug: select 1 as id
[0m07:24:03.653509 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:24:03.676744 [debug] [MainThread]: SQL status: SELECT 1 in 0.023 seconds
[0m07:24:03.678251 [debug] [MainThread]: On debug: Close
[0m07:24:03.679179 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:24:03.679811 [info ] [MainThread]: [31m1 check failed:[0m
[0m07:24:03.680350 [info ] [MainThread]: Project loading failed for the following reason:
 project path </home/zakaria/projets/dw/DBT/dbt_project.yml> not found

[0m07:24:03.681658 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.3545409, "process_in_blocks": "2440", "process_kernel_time": 0.310777, "process_mem_max_rss": "111996", "process_out_blocks": "32", "process_user_time": 2.191379}
[0m07:24:03.682505 [debug] [MainThread]: Command `dbt debug` failed at 07:24:03.682336 after 0.36 seconds
[0m07:24:03.683065 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:24:03.683620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f60b7810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f9fe3f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f5bdb490>]}
[0m07:24:03.684247 [debug] [MainThread]: Flushing usage events
[0m07:24:04.744352 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:16:36.432750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C496C320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C7F71280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C7D5FB90>]}


============================== 11:16:36.453403 | f2c4cef2-5c85-4b26-853e-df6bb9517104 ==============================
[0m11:16:36.453403 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:16:36.453403 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt clean', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:16:36.710188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2c4cef2-5c85-4b26-853e-df6bb9517104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C7C80A70>]}
[0m11:16:37.007248 [debug] [MainThread]: Command `dbt clean` succeeded at 11:16:37.007248 after 0.77 seconds
[0m11:16:37.007248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C7CFCE30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C7CFE1E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F6C7CFFA40>]}
[0m11:16:37.007248 [debug] [MainThread]: Flushing usage events
[0m11:16:37.818642 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:16:48.379476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D2FB7C800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D2F92AF00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D2FE9E150>]}


============================== 11:16:48.379476 | e7099be2-540d-4040-9fa0-da495b5a7391 ==============================
[0m11:16:48.379476 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:16:48.379476 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m11:16:48.633160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7099be2-540d-4040-9fa0-da495b5a7391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D302B7380>]}
[0m11:16:48.700295 [debug] [MainThread]: Set downloads directory='C:\Users\Ahmed\AppData\Local\Temp\dbt-downloads-cqv0ws7l'
[0m11:16:48.708779 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m11:16:49.068895 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m11:16:49.068895 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m11:16:49.272006 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m11:16:49.276295 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json
[0m11:16:49.509380 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json 200
[0m11:16:49.537481 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json
[0m11:16:49.796044 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json 200
[0m11:16:49.804910 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json
[0m11:16:50.017321 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json 200
[0m11:16:50.026142 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `calogica/dbt_date` package is deprecated in favor of
`godatadriven/dbt_date`. Please update your `packages.yml` configuration to use
`godatadriven/dbt_date` instead.
[0m11:16:50.037918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e7099be2-540d-4040-9fa0-da495b5a7391', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D303F86E0>]}
[0m11:16:50.061610 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m11:16:51.296677 [info ] [MainThread]: Installed from version 1.1.1
[0m11:16:51.298725 [info ] [MainThread]: Updated version available: 1.3.0
[0m11:16:51.298725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'e7099be2-540d-4040-9fa0-da495b5a7391', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D31727590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D303BBA10>]}
[0m11:16:51.298725 [info ] [MainThread]: Installing metaplane/dbt_expectations
[0m11:16:55.398373 [info ] [MainThread]: Installed from version 0.8.5
[0m11:16:55.408810 [info ] [MainThread]: Updated version available: 0.10.8
[0m11:16:55.412324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'e7099be2-540d-4040-9fa0-da495b5a7391', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D317C1430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D317C1490>]}
[0m11:16:55.412324 [info ] [MainThread]: Installing dbt-labs/spark_utils
[0m11:16:55.891210 [info ] [MainThread]: Installed from version 0.3.0
[0m11:16:55.895993 [info ] [MainThread]: Up to date!
[0m11:16:55.898508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'e7099be2-540d-4040-9fa0-da495b5a7391', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D302B7290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D317C1820>]}
[0m11:16:55.898508 [info ] [MainThread]: Installing calogica/dbt_date
[0m11:16:56.524473 [info ] [MainThread]: Installed from version 0.7.2
[0m11:16:56.524473 [info ] [MainThread]: Updated version available: 0.10.1
[0m11:16:56.524473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'e7099be2-540d-4040-9fa0-da495b5a7391', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D317C1D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D317C1A00>]}
[0m11:16:56.524473 [info ] [MainThread]: 
[0m11:16:56.532473 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils', 'metaplane/dbt_expectations', 'calogica/dbt_date']                 
Update your versions in packages.yml, then run dbt deps
[0m11:16:56.536676 [debug] [MainThread]: Command `dbt deps` succeeded at 11:16:56.536676 after 8.33 seconds
[0m11:16:56.541203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D2F74F770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D2F74EAE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D2FE2CFE0>]}
[0m11:16:56.546548 [debug] [MainThread]: Flushing usage events
[0m11:16:57.218398 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:17:13.613072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF379E750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF379FF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF379F740>]}


============================== 11:17:13.613072 | 880879fa-a5ef-46de-97f6-9316d8632933 ==============================
[0m11:17:13.613072 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:17:13.613072 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:17:14.072273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF0D723C0>]}
[0m11:17:14.205652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF3C5DCD0>]}
[0m11:17:14.210095 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m11:17:14.881791 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m11:17:14.881791 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:17:14.881791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF4D59520>]}
[0m11:17:20.809855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF57235F0>]}
[0m11:17:21.086896 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m11:17:21.111245 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m11:17:21.175126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF58F4650>]}
[0m11:17:21.175126 [info ] [MainThread]: Found 4 models, 79 data tests, 1 source, 797 macros
[0m11:17:21.175126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF58BDD60>]}
[0m11:17:21.184313 [info ] [MainThread]: 
[0m11:17:21.184313 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:17:21.189357 [info ] [MainThread]: 
[0m11:17:21.189357 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:17:21.199337 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m11:17:25.760532 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m11:17:25.760532 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m11:17:25.760532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:17:25.912554 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.147 seconds
[0m11:17:25.912554 [debug] [ThreadPool]: On list_DataWare: Close
[0m11:17:25.928175 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m11:17:25.928175 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m11:17:25.928175 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m11:17:25.928175 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:17:26.025825 [debug] [ThreadPool]: SQL status: BEGIN in 0.090 seconds
[0m11:17:26.025825 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m11:17:26.025825 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:17:26.057068 [debug] [ThreadPool]: SQL status: SELECT 47 in 0.026 seconds
[0m11:17:26.061086 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m11:17:26.061086 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m11:17:26.076752 [debug] [MainThread]: Using postgres connection "master"
[0m11:17:26.076752 [debug] [MainThread]: On master: BEGIN
[0m11:17:26.076752 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:17:26.160962 [debug] [MainThread]: SQL status: BEGIN in 0.081 seconds
[0m11:17:26.160962 [debug] [MainThread]: Using postgres connection "master"
[0m11:17:26.160962 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:17:26.180487 [debug] [MainThread]: SQL status: SELECT 1 in 0.025 seconds
[0m11:17:26.196119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF58D2000>]}
[0m11:17:26.196119 [debug] [MainThread]: On master: ROLLBACK
[0m11:17:26.196119 [debug] [MainThread]: Using postgres connection "master"
[0m11:17:26.196119 [debug] [MainThread]: On master: BEGIN
[0m11:17:26.196119 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:17:26.196119 [debug] [MainThread]: On master: COMMIT
[0m11:17:26.196119 [debug] [MainThread]: Using postgres connection "master"
[0m11:17:26.196119 [debug] [MainThread]: On master: COMMIT
[0m11:17:26.196119 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:17:26.196119 [debug] [MainThread]: On master: Close
[0m11:17:26.211741 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m11:17:26.211741 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m11:17:26.211741 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m11:17:26.211741 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m11:17:26.228737 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.242978 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m11:17:26.296493 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.312115 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.312115 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m11:17:26.312115 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:17:26.392439 [debug] [Thread-1 (]: SQL status: BEGIN in 0.087 seconds
[0m11:17:26.404988 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.404988 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

cleaned_source as (
    select
        id,
        lower(coalesce(bank_name, 'Unknown Bank')) as bank_name,
        lower(coalesce(branch_name, 'Unknown Branch')) as branch_name,
        coalesce(review_date, current_date) as review_date,
        coalesce(rating, 0) as rating,
        -- Handle missing text values
        
    case 
        when review_text is null or trim(review_text) = '' 
        then 'No review provided'
        else review_text
    end
 as review_text,
        coalesce(created_at, current_timestamp) as created_at
    from source
),

-- Remove duplicates based on cleaned text content
deduplicated as (
    select * from (
        select *,
            row_number() over (
                partition by 
                    bank_name,
                    branch_name,
                    
    
    (
        select string_agg(word, ' ')
        from (
            select unnest(string_to_array(
    trim(
        regexp_replace(
            regexp_replace(
                
    lower(trim(coalesce(
    case 
        when review_text is null or trim(review_text) = '' 
        then ''
        else review_text
    end
, '')))
,
                '[^a-zA-ZÀ-ÿ\u0600-\u06FF0-9\s]',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    )
, ' ')) as word
        ) words
        where length(trim(word)) > 0
        and lower(trim(word)) not in (
            -- English stop words
            'the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'with', 'by', 'about', 'as', 'of', 'from',
            'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did',
            'will', 'would', 'shall', 'should', 'can', 'could', 'may', 'might', 'must', 'a', 'an', 'this',
            'that', 'these', 'those', 'i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us',
            'them', 'my', 'your', 'his', 'her', 'its', 'our', 'their', 'what', 'which', 'who', 'where', 
            'when', 'why', 'how', 'all', 'any', 'some', 'no', 'not', 'only', 'very', 'so', 'too',
            
            -- French stop words
            'le', 'la', 'les', 'un', 'une', 'des', 'du', 'de', 'et', 'ou', 'mais', 'dans', 'sur', 'à', 'pour',
            'avec', 'par', 'comme', 'ce', 'cette', 'ces', 'mon', 'ton', 'son', 'ma', 'ta', 'sa', 'mes', 'tes', 
            'ses', 'notre', 'votre', 'leur', 'qui', 'que', 'dont', 'où', 'quand', 'comment', 'pourquoi',
            'si', 'car', 'donc', 'ne', 'pas', 'plus', 'moins', 'très', 'bien', 'mal', 'peu', 'beaucoup',
            'trop', 'aussi', 'encore', 'déjà', 'toujours', 'jamais', 'je', 'tu', 'il', 'elle', 'nous', 
            'vous', 'ils', 'elles', 'être', 'avoir', 'faire', 'aller',
            
            -- Arabic stop words
            'في', 'من', 'على', 'إلى', 'عن', 'مع', 'ب', 'ك', 'ل', 'و', 'أو', 'لكن', 'أن', 'إن', 
            'أنا', 'أنت', 'هو', 'هي', 'نحن', 'أنتم', 'هم', 'هن', 'هذا', 'هذه', 'هؤلاء', 'ذلك', 
            'تلك', 'أولئك', 'الذي', 'التي', 'ما', 'أين', 'متى', 'كيف', 'لماذا', 'كل', 'بعض',
            'كان', 'كانت', 'يكون', 'ليس', 'ليست', 'قد', 'عند', 'بعد', 'قبل', 'حول', 'بين',
            'ال', 'الـ'
        )
    )


                order by created_at desc
            ) as row_num
        from cleaned_source
    ) ranked
    where row_num = 1
),

staged as (
    select
        id,
        bank_name,
        branch_name,
        review_date,
        rating,
        -- Original review text
        review_text,
        -- Normalized text (lowercase, trimmed)
        
    lower(trim(coalesce(review_text, '')))
 as normalized_review_text,
        -- Text without punctuation
        
    trim(
        regexp_replace(
            regexp_replace(
                
    lower(trim(coalesce(review_text, '')))
,
                '[^a-zA-ZÀ-ÿ\u0600-\u06FF0-9\s]',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    )
 as clean_review_text,
        -- Fully processed text (normalized + no punctuation + no stop words)
        
    
    (
        select string_agg(word, ' ')
        from (
            select unnest(string_to_array(
    trim(
        regexp_replace(
            regexp_replace(
                
    lower(trim(coalesce(
    case 
        when review_text is null or trim(review_text) = '' 
        then ''
        else review_text
    end
, '')))
,
                '[^a-zA-ZÀ-ÿ\u0600-\u06FF0-9\s]',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    )
, ' ')) as word
        ) words
        where length(trim(word)) > 0
        and lower(trim(word)) not in (
            -- English stop words
            'the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'with', 'by', 'about', 'as', 'of', 'from',
            'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did',
            'will', 'would', 'shall', 'should', 'can', 'could', 'may', 'might', 'must', 'a', 'an', 'this',
            'that', 'these', 'those', 'i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us',
            'them', 'my', 'your', 'his', 'her', 'its', 'our', 'their', 'what', 'which', 'who', 'where', 
            'when', 'why', 'how', 'all', 'any', 'some', 'no', 'not', 'only', 'very', 'so', 'too',
            
            -- French stop words
            'le', 'la', 'les', 'un', 'une', 'des', 'du', 'de', 'et', 'ou', 'mais', 'dans', 'sur', 'à', 'pour',
            'avec', 'par', 'comme', 'ce', 'cette', 'ces', 'mon', 'ton', 'son', 'ma', 'ta', 'sa', 'mes', 'tes', 
            'ses', 'notre', 'votre', 'leur', 'qui', 'que', 'dont', 'où', 'quand', 'comment', 'pourquoi',
            'si', 'car', 'donc', 'ne', 'pas', 'plus', 'moins', 'très', 'bien', 'mal', 'peu', 'beaucoup',
            'trop', 'aussi', 'encore', 'déjà', 'toujours', 'jamais', 'je', 'tu', 'il', 'elle', 'nous', 
            'vous', 'ils', 'elles', 'être', 'avoir', 'faire', 'aller',
            
            -- Arabic stop words
            'في', 'من', 'على', 'إلى', 'عن', 'مع', 'ب', 'ك', 'ل', 'و', 'أو', 'لكن', 'أن', 'إن', 
            'أنا', 'أنت', 'هو', 'هي', 'نحن', 'أنتم', 'هم', 'هن', 'هذا', 'هذه', 'هؤلاء', 'ذلك', 
            'تلك', 'أولئك', 'الذي', 'التي', 'ما', 'أين', 'متى', 'كيف', 'لماذا', 'كل', 'بعض',
            'كان', 'كانت', 'يكون', 'ليس', 'ليست', 'قد', 'عند', 'بعد', 'قبل', 'حول', 'بين',
            'ال', 'الـ'
        )
    )

 as processed_review_text,
        -- Text statistics
        length(review_text) as original_text_length,
        length(
    
    (
        select string_agg(word, ' ')
        from (
            select unnest(string_to_array(
    trim(
        regexp_replace(
            regexp_replace(
                
    lower(trim(coalesce(
    case 
        when review_text is null or trim(review_text) = '' 
        then ''
        else review_text
    end
, '')))
,
                '[^a-zA-ZÀ-ÿ\u0600-\u06FF0-9\s]',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    )
, ' ')) as word
        ) words
        where length(trim(word)) > 0
        and lower(trim(word)) not in (
            -- English stop words
            'the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'with', 'by', 'about', 'as', 'of', 'from',
            'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did',
            'will', 'would', 'shall', 'should', 'can', 'could', 'may', 'might', 'must', 'a', 'an', 'this',
            'that', 'these', 'those', 'i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us',
            'them', 'my', 'your', 'his', 'her', 'its', 'our', 'their', 'what', 'which', 'who', 'where', 
            'when', 'why', 'how', 'all', 'any', 'some', 'no', 'not', 'only', 'very', 'so', 'too',
            
            -- French stop words
            'le', 'la', 'les', 'un', 'une', 'des', 'du', 'de', 'et', 'ou', 'mais', 'dans', 'sur', 'à', 'pour',
            'avec', 'par', 'comme', 'ce', 'cette', 'ces', 'mon', 'ton', 'son', 'ma', 'ta', 'sa', 'mes', 'tes', 
            'ses', 'notre', 'votre', 'leur', 'qui', 'que', 'dont', 'où', 'quand', 'comment', 'pourquoi',
            'si', 'car', 'donc', 'ne', 'pas', 'plus', 'moins', 'très', 'bien', 'mal', 'peu', 'beaucoup',
            'trop', 'aussi', 'encore', 'déjà', 'toujours', 'jamais', 'je', 'tu', 'il', 'elle', 'nous', 
            'vous', 'ils', 'elles', 'être', 'avoir', 'faire', 'aller',
            
            -- Arabic stop words
            'في', 'من', 'على', 'إلى', 'عن', 'مع', 'ب', 'ك', 'ل', 'و', 'أو', 'لكن', 'أن', 'إن', 
            'أنا', 'أنت', 'هو', 'هي', 'نحن', 'أنتم', 'هم', 'هن', 'هذا', 'هذه', 'هؤلاء', 'ذلك', 
            'تلك', 'أولئك', 'الذي', 'التي', 'ما', 'أين', 'متى', 'كيف', 'لماذا', 'كل', 'بعض',
            'كان', 'كانت', 'يكون', 'ليس', 'ليست', 'قد', 'عند', 'بعد', 'قبل', 'حول', 'بين',
            'ال', 'الـ'
        )
    )

) as processed_text_length,
        (
            case 
                when trim(review_text) = '' then 0
                else array_length(string_to_array(trim(review_text), ' '), 1)
            end
        ) as word_count,
        -- Basic language detection
        case
            when review_text ~ '[\u0600-\u06FF]' then 'arabic'
            when review_text ~ '[àâäéèêëïîôöùûüÿç]' then 'french'  
            when review_text ~ '^[a-zA-Z\s\p{P}]+$' then 'english'
            else 'mixed'
        end as detected_language,
        created_at
    from deduplicated
    where review_text != 'No review provided'  -- Filter out placeholder values
)

select * from staged
  );
[0m11:17:26.446313 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.041 seconds
[0m11:17:26.466639 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.471547 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m11:17:26.473934 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m11:17:26.481223 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.481223 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m11:17:26.481223 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m11:17:26.516124 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m11:17:26.521367 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.521367 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m11:17:26.527667 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m11:17:26.538970 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m11:17:26.545428 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:17:26.545428 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m11:17:26.561325 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.008 seconds
[0m11:17:26.561325 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m11:17:26.561325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF0D715B0>]}
[0m11:17:26.561325 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.35s]
[0m11:17:26.561325 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m11:17:26.576968 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m11:17:26.576968 [info ] [Thread-3 (]: 2 of 3 START sql table model public.int_bank_reviews ........................... [RUN]
[0m11:17:26.576968 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m11:17:26.582234 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m11:17:26.587737 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m11:17:26.594822 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m11:17:26.661602 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m11:17:26.668737 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:17:26.681125 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m11:17:26.681125 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m11:17:26.797410 [debug] [Thread-3 (]: SQL status: BEGIN in 0.114 seconds
[0m11:17:26.797605 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:17:26.797605 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    

with staged_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

sentiment_analysis as (
    select
        *,
        -- Enhanced sentiment detection using both rating and text
        case
            -- Strong positive indicators
            when rating >= 4 and (
                lower(review_text) like '%excellent%' or
                lower(review_text) like '%amazing%' or
                lower(review_text) like '%fantastic%' or
                lower(review_text) like '%great%' or
                lower(review_text) like '%wonderful%' or
                lower(review_text) like '%perfect%' or
                lower(review_text) like '%outstanding%' or
                lower(review_text) like '%superb%' or
                lower(review_text) like '%brilliant%' or
                lower(review_text) like '%awesome%' or
                lower(review_text) like '%love%' or
                lower(review_text) like '%best%'
            ) then 'very_positive'
            when rating >= 4 then 'positive'
            -- Strong negative indicators  
            when rating <= 2 and (
                lower(review_text) like '%terrible%' or
                lower(review_text) like '%awful%' or
                lower(review_text) like '%horrible%' or
                lower(review_text) like '%worst%' or
                lower(review_text) like '%hate%' or
                lower(review_text) like '%disgusting%' or
                lower(review_text) like '%pathetic%' or
                lower(review_text) like '%useless%' or
                lower(review_text) like '%disappointing%' or
                lower(review_text) like '%frustrating%' or
                lower(review_text) like '%annoying%'
            ) then 'very_negative'
            when rating <= 2 then 'negative'
            -- Neutral with slight variations
            when rating = 3 and (
                lower(review_text) like '%good%' or
                lower(review_text) like '%nice%' or
                lower(review_text) like '%helpful%' or
                lower(review_text) like '%satisfied%' or
                lower(review_text) like '%pleasant%' or
                lower(review_text) like '%decent%' or
                lower(review_text) like '%acceptable%' or
                lower(review_text) like '%fine%' or
                lower(review_text) like '%ok%' or
                lower(review_text) like '%okay%'
            ) then 'somewhat_positive'
            when rating = 3 and (
                lower(review_text) like '%bad%' or
                lower(review_text) like '%poor%' or
                lower(review_text) like '%slow%' or
                lower(review_text) like '%expensive%' or
                lower(review_text) like '%limited%' or
                lower(review_text) like '%lacking%' or
                lower(review_text) like '%issues%' or
                lower(review_text) like '%problems%' or
                lower(review_text) like '%concerns%' or
                lower(review_text) like '%disappointed%'
            ) then 'somewhat_negative'
            when rating = 3 then 'neutral'
            else 'neutral'
        end as detailed_sentiment,
        
        -- Simplified sentiment for reporting
        case
            when rating >= 4 then 'positive'
            when rating = 3 then 'neutral'
            else 'negative'
        end as sentiment,
        
        -- Text quality indicators
        case
            when word_count = 0 then 'no_text'
            when word_count <= 5 then 'very_short'
            when word_count <= 15 then 'short'
            when word_count <= 50 then 'medium'
            else 'long'
        end as review_length_category,
        
        -- Meaningful content indicator
        case
            when processed_text_length > 0 and word_count >= 3 then true
            else false
        end as has_meaningful_content
        
    from staged_reviews
),

final as (
    select
        id,
        bank_name,
        branch_name,
        review_date,
        rating,
        -- Text fields
        review_text,
        normalized_review_text,
        clean_review_text,
        processed_review_text,
        -- Metrics
        original_text_length,
        processed_text_length,
        word_count,
        detected_language,
        -- Analysis
        sentiment,
        detailed_sentiment,
        review_length_category,
        has_meaningful_content,
        created_at
    from sentiment_analysis
    where has_meaningful_content = true  -- Only keep reviews with actual content
)

select * from final
  );
  
[0m11:17:27.148134 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  expression rationnelle invalide : invalid escape \ sequence

[0m11:17:27.148134 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m11:17:27.148134 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m11:17:27.363592 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  expression rationnelle invalide : invalid escape \ sequence
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m11:17:27.363592 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '880879fa-a5ef-46de-97f6-9316d8632933', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF5E66180>]}
[0m11:17:27.363592 [error] [Thread-3 (]: 2 of 3 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.79s]
[0m11:17:27.363592 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m11:17:27.373791 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  expression rationnelle invalide : invalid escape \ sequence
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m11:17:27.374933 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_bank_review_summary
[0m11:17:27.374933 [info ] [Thread-2 (]: 3 of 3 SKIP relation public.mart_bank_review_summary ........................... [[33mSKIP[0m]
[0m11:17:27.374933 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_bank_review_summary
[0m11:17:27.374933 [debug] [MainThread]: Using postgres connection "master"
[0m11:17:27.374933 [debug] [MainThread]: On master: BEGIN
[0m11:17:27.374933 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:17:27.490558 [debug] [MainThread]: SQL status: BEGIN in 0.114 seconds
[0m11:17:27.490558 [debug] [MainThread]: On master: COMMIT
[0m11:17:27.490558 [debug] [MainThread]: Using postgres connection "master"
[0m11:17:27.498557 [debug] [MainThread]: On master: COMMIT
[0m11:17:27.498557 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:17:27.498557 [debug] [MainThread]: On master: Close
[0m11:17:27.498557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:17:27.498557 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m11:17:27.498557 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m11:17:27.498557 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m11:17:27.506066 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m11:17:27.506066 [info ] [MainThread]: 
[0m11:17:27.506066 [info ] [MainThread]: Finished running 2 table models, 1 view model in 0 hours 0 minutes and 6.32 seconds (6.32s).
[0m11:17:27.513717 [debug] [MainThread]: Command end result
[0m11:17:27.609310 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m11:17:27.620801 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m11:17:27.630884 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m11:17:27.630884 [info ] [MainThread]: 
[0m11:17:27.630884 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:17:27.630884 [info ] [MainThread]: 
[0m11:17:27.637295 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  expression rationnelle invalide : invalid escape \ sequence
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m11:17:27.640002 [info ] [MainThread]: 
[0m11:17:27.642433 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m11:17:27.642433 [debug] [MainThread]: Command `dbt run` failed at 11:17:27.642433 after 14.21 seconds
[0m11:17:27.642433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF350E210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF3A40860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019CF3A437A0>]}
[0m11:17:27.642433 [debug] [MainThread]: Flushing usage events
[0m11:17:28.355243 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:46:15.766926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492EF60170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492E6E76B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492E6E77A0>]}


============================== 11:46:15.782563 | 9a72ab86-a3a3-4155-8fe7-521c5626bdbd ==============================
[0m11:46:15.782563 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:46:15.782563 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:46:16.073502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a72ab86-a3a3-4155-8fe7-521c5626bdbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492F1E1400>]}
[0m11:46:16.151642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a72ab86-a3a3-4155-8fe7-521c5626bdbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492EF927B0>]}
[0m11:46:16.151642 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m11:46:16.557364 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing enabled: 6 files deleted, 1 files added, 2 files changed.
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing: added file: bank_reviews_analysis://macros\normalize_text.sql
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing: deleted file: bank_reviews_analysis://models\marts\mart_bank_review_summary.sql
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing: deleted file: bank_reviews_analysis://macros\text_utils.sql
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing: deleted file: bank_reviews_analysis://models\marts\mart_review_text_analysis.sql
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\intermediate\int_bank_reviews.sql
[0m11:46:16.945729 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\staging\stg_bank_reviews.sql
[0m11:46:17.225980 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.bank_reviews_analysis.stg_bank_reviews' (models\staging\stg_bank_reviews.sql) depends on a source named 'raw.bank_reviews' which was not found
[0m11:46:17.225980 [debug] [MainThread]: Command `dbt run` failed at 11:46:17.225980 after 1.61 seconds
[0m11:46:17.225980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492EF60170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249309DB290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002492CC425A0>]}
[0m11:46:17.225980 [debug] [MainThread]: Flushing usage events
[0m11:46:18.012457 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:48:51.188645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227C2E57F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227A322660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227E780170>]}


============================== 11:48:51.204279 | d7524d7a-6196-4969-af58-69b213f284bb ==============================
[0m11:48:51.204279 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:48:51.204279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m11:48:51.395835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd7524d7a-6196-4969-af58-69b213f284bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227E9972C0>]}
[0m11:48:51.635819 [debug] [MainThread]: Command `dbt clean` succeeded at 11:48:51.635819 after 0.59 seconds
[0m11:48:51.635819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227C2E57F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227E9D0470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002227DE537A0>]}
[0m11:48:51.635819 [debug] [MainThread]: Flushing usage events
[0m11:48:52.391450 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:49:09.262041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F310151C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F3308CCB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F3308DEE0>]}


============================== 11:49:09.277679 | d3ec8a57-463e-40fc-a90c-20e1585cc71c ==============================
[0m11:49:09.277679 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:49:09.277679 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt deps', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:49:09.467709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3ec8a57-463e-40fc-a90c-20e1585cc71c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F350221E0>]}
[0m11:49:09.514612 [debug] [MainThread]: Set downloads directory='C:\Users\Ahmed\AppData\Local\Temp\dbt-downloads-xzuej9oy'
[0m11:49:09.514612 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m11:49:09.868687 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m11:49:09.868687 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m11:49:10.079749 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m11:49:10.130554 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json
[0m11:49:10.369898 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json 200
[0m11:49:10.376432 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json
[0m11:49:10.609415 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json 200
[0m11:49:10.624957 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json
[0m11:49:10.857321 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json 200
[0m11:49:10.857321 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `calogica/dbt_date` package is deprecated in favor of
`godatadriven/dbt_date`. Please update your `packages.yml` configuration to use
`godatadriven/dbt_date` instead.
[0m11:49:10.857321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd3ec8a57-463e-40fc-a90c-20e1585cc71c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F353C6F90>]}
[0m11:49:10.877964 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m11:49:11.895065 [info ] [MainThread]: Installed from version 1.1.1
[0m11:49:11.895065 [info ] [MainThread]: Updated version available: 1.3.0
[0m11:49:11.895065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'd3ec8a57-463e-40fc-a90c-20e1585cc71c', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F353DA480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F33528260>]}
[0m11:49:11.910709 [info ] [MainThread]: Installing metaplane/dbt_expectations
[0m11:49:26.773775 [info ] [MainThread]: Installed from version 0.8.5
[0m11:49:26.773775 [info ] [MainThread]: Updated version available: 0.10.8
[0m11:49:26.773775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'd3ec8a57-463e-40fc-a90c-20e1585cc71c', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F35444A10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F354448F0>]}
[0m11:49:26.773775 [info ] [MainThread]: Installing dbt-labs/spark_utils
[0m11:49:27.283284 [info ] [MainThread]: Installed from version 0.3.0
[0m11:49:27.283284 [info ] [MainThread]: Up to date!
[0m11:49:27.283284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'd3ec8a57-463e-40fc-a90c-20e1585cc71c', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F33501880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F33502B10>]}
[0m11:49:27.283284 [info ] [MainThread]: Installing calogica/dbt_date
[0m11:49:27.907320 [info ] [MainThread]: Installed from version 0.7.2
[0m11:49:27.907320 [info ] [MainThread]: Updated version available: 0.10.1
[0m11:49:27.907320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'd3ec8a57-463e-40fc-a90c-20e1585cc71c', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F354447A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F35445070>]}
[0m11:49:27.907320 [info ] [MainThread]: 
[0m11:49:27.907320 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils', 'metaplane/dbt_expectations', 'calogica/dbt_date']                 
Update your versions in packages.yml, then run dbt deps
[0m11:49:27.907320 [debug] [MainThread]: Command `dbt deps` succeeded at 11:49:27.907320 after 18.79 seconds
[0m11:49:27.907320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F33D93A40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F313DD7F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F353C6F90>]}
[0m11:49:27.907320 [debug] [MainThread]: Flushing usage events
[0m11:49:28.582343 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:50:44.692265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBEBE52660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF02610A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBEFE01250>]}


============================== 11:50:44.692265 | cba38c0f-a51d-44e8-b980-1f3fde45f861 ==============================
[0m11:50:44.692265 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:50:44.692265 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:50:44.881319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cba38c0f-a51d-44e8-b980-1f3fde45f861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBEFA1FC80>]}
[0m11:50:44.929210 [debug] [MainThread]: Set downloads directory='C:\Users\Ahmed\AppData\Local\Temp\dbt-downloads-hjqhobjn'
[0m11:50:44.929210 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m11:50:45.243718 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m11:50:45.243718 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m11:50:45.447434 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m11:50:45.482257 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json
[0m11:50:45.682678 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json 200
[0m11:50:45.698357 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json
[0m11:50:45.933597 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json 200
[0m11:50:45.933597 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/godatadriven/dbt_date.json
[0m11:50:46.162357 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/godatadriven/dbt_date.json 200
[0m11:50:46.231398 [info ] [MainThread]: Updating lock file in file path: C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT/package-lock.yml
[0m11:50:46.419469 [debug] [MainThread]: Set downloads directory='C:\Users\Ahmed\AppData\Local\Temp\dbt-downloads-3d6ohvfa'
[0m11:50:46.435098 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m11:50:47.368666 [info ] [MainThread]: Installed from version 1.3.0
[0m11:50:47.368666 [info ] [MainThread]: Up to date!
[0m11:50:47.368666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'cba38c0f-a51d-44e8-b980-1f3fde45f861', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF193D610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF0589820>]}
[0m11:50:47.368666 [info ] [MainThread]: Installing metaplane/dbt_expectations
[0m11:50:57.814645 [info ] [MainThread]: Installed from version 0.10.8
[0m11:50:57.830271 [info ] [MainThread]: Up to date!
[0m11:50:57.830271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'cba38c0f-a51d-44e8-b980-1f3fde45f861', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF051ECC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBEF9D2ED0>]}
[0m11:50:57.830271 [info ] [MainThread]: Installing dbt-labs/spark_utils
[0m11:50:58.314698 [info ] [MainThread]: Installed from version 0.3.0
[0m11:50:58.314698 [info ] [MainThread]: Up to date!
[0m11:50:58.314698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'cba38c0f-a51d-44e8-b980-1f3fde45f861', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBEFF708C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF004F1D0>]}
[0m11:50:58.323606 [info ] [MainThread]: Installing godatadriven/dbt_date
[0m11:50:59.079372 [info ] [MainThread]: Installed from version 0.10.1
[0m11:50:59.079372 [info ] [MainThread]: Updated version available: 0.14.1
[0m11:50:59.079372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'cba38c0f-a51d-44e8-b980-1f3fde45f861', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF004F1D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF18E2DE0>]}
[0m11:50:59.079372 [info ] [MainThread]: 
[0m11:50:59.079372 [info ] [MainThread]: Updates available for packages: ['godatadriven/dbt_date']                 
Update your versions in packages.yml, then run dbt deps
[0m11:50:59.087368 [debug] [MainThread]: Command `dbt deps` succeeded at 11:50:59.087368 after 14.54 seconds
[0m11:50:59.087368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF01E81A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF05AB7A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBF18FE900>]}
[0m11:50:59.087368 [debug] [MainThread]: Flushing usage events
[0m11:50:59.838568 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:51:26.261450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA8EE9F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA8EE8350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA6357BF0>]}


============================== 11:51:26.278145 | b95a4867-f9c8-43e7-bcc5-b5e6a6e7d8e6 ==============================
[0m11:51:26.278145 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:51:26.278145 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:51:26.461873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b95a4867-f9c8-43e7-bcc5-b5e6a6e7d8e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA89CD040>]}
[0m11:51:26.508726 [debug] [MainThread]: Set downloads directory='C:\Users\Ahmed\AppData\Local\Temp\dbt-downloads-1m_va9ii'
[0m11:51:26.508726 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m11:51:26.745938 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m11:51:26.745938 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m11:51:27.040311 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m11:51:27.062551 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json
[0m11:51:27.347891 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/metaplane/dbt_expectations.json 200
[0m11:51:27.367823 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json
[0m11:51:27.711895 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/spark_utils.json 200
[0m11:51:27.711895 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/godatadriven/dbt_date.json
[0m11:51:27.981733 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/godatadriven/dbt_date.json 200
[0m11:51:28.081981 [info ] [MainThread]: Updating lock file in file path: C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT/package-lock.yml
[0m11:51:28.373713 [debug] [MainThread]: Set downloads directory='C:\Users\Ahmed\AppData\Local\Temp\dbt-downloads-3r6cc42g'
[0m11:51:28.383776 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m11:51:29.383624 [info ] [MainThread]: Installed from version 1.3.0
[0m11:51:29.383624 [info ] [MainThread]: Up to date!
[0m11:51:29.383624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b95a4867-f9c8-43e7-bcc5-b5e6a6e7d8e6', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA9042EA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CAA4D94C0>]}
[0m11:51:29.383624 [info ] [MainThread]: Installing metaplane/dbt_expectations
[0m11:51:42.051918 [info ] [MainThread]: Installed from version 0.10.8
[0m11:51:42.051918 [info ] [MainThread]: Up to date!
[0m11:51:42.051918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b95a4867-f9c8-43e7-bcc5-b5e6a6e7d8e6', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA9098920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CAA4373E0>]}
[0m11:51:42.051918 [info ] [MainThread]: Installing dbt-labs/spark_utils
[0m11:51:42.566264 [info ] [MainThread]: Installed from version 0.3.0
[0m11:51:42.566264 [info ] [MainThread]: Up to date!
[0m11:51:42.566264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b95a4867-f9c8-43e7-bcc5-b5e6a6e7d8e6', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CAA4834D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CAA482DE0>]}
[0m11:51:42.573801 [info ] [MainThread]: Installing godatadriven/dbt_date
[0m11:51:43.444565 [info ] [MainThread]: Installed from version 0.14.1
[0m11:51:43.470525 [info ] [MainThread]: Up to date!
[0m11:51:43.527682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b95a4867-f9c8-43e7-bcc5-b5e6a6e7d8e6', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CAA482DE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA90BB9E0>]}
[0m11:51:43.527682 [debug] [MainThread]: Command `dbt deps` succeeded at 11:51:43.527682 after 17.40 seconds
[0m11:51:43.535740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA8B960F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA89CD040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029CA8FEDBB0>]}
[0m11:51:43.537781 [debug] [MainThread]: Flushing usage events
[0m11:51:44.190708 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:51:51.932370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CA0C5190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CA9D6360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CA9D68A0>]}


============================== 11:51:51.938879 | 083f2e40-f46b-49a4-94e2-60190e908ff5 ==============================
[0m11:51:51.938879 [info ] [MainThread]: Running with dbt=1.9.6
[0m11:51:51.938879 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:51:52.201726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CD1C7440>]}
[0m11:51:52.279649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CC79DF40>]}
[0m11:51:52.279649 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m11:51:52.733693 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m11:51:52.733693 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:51:52.733693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CE561D90>]}
[0m11:51:56.811975 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m11:51:56.832191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CE9A3680>]}
[0m11:51:56.944355 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m11:51:56.961005 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m11:51:57.007893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CE9C63C0>]}
[0m11:51:57.007893 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m11:51:57.007893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CE7B5760>]}
[0m11:51:57.007893 [info ] [MainThread]: 
[0m11:51:57.007893 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:51:57.007893 [info ] [MainThread]: 
[0m11:51:57.019516 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:51:57.024586 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m11:51:57.146345 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m11:51:57.146345 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m11:51:57.146345 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:51:57.292908 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.141 seconds
[0m11:51:57.292908 [debug] [ThreadPool]: On list_DataWare: Close
[0m11:51:57.292908 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m11:51:57.308538 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m11:51:57.308538 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m11:51:57.324192 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:51:57.423080 [debug] [ThreadPool]: SQL status: BEGIN in 0.100 seconds
[0m11:51:57.423080 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m11:51:57.423080 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:51:57.455747 [debug] [ThreadPool]: SQL status: SELECT 47 in 0.027 seconds
[0m11:51:57.462266 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m11:51:57.462266 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m11:51:57.488616 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:57.488616 [debug] [MainThread]: On master: BEGIN
[0m11:51:57.496616 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:51:57.573261 [debug] [MainThread]: SQL status: BEGIN in 0.090 seconds
[0m11:51:57.589532 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:57.590169 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:51:57.606377 [debug] [MainThread]: SQL status: SELECT 1 in 0.021 seconds
[0m11:51:57.606377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CD1973B0>]}
[0m11:51:57.606377 [debug] [MainThread]: On master: ROLLBACK
[0m11:51:57.606377 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:57.606377 [debug] [MainThread]: On master: BEGIN
[0m11:51:57.606377 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:51:57.606377 [debug] [MainThread]: On master: COMMIT
[0m11:51:57.623198 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:57.623198 [debug] [MainThread]: On master: COMMIT
[0m11:51:57.623198 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:51:57.623198 [debug] [MainThread]: On master: Close
[0m11:51:57.623198 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m11:51:57.623198 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m11:51:57.638904 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m11:51:57.638904 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m11:51:57.646914 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.655656 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m11:51:57.705306 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.713319 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.713319 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m11:51:57.713319 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:51:57.778044 [debug] [Thread-1 (]: SQL status: BEGIN in 0.071 seconds
[0m11:51:57.778044 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.778044 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m11:51:57.809296 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.020 seconds
[0m11:51:57.809296 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.809296 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m11:51:57.824919 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m11:51:57.824919 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.824919 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m11:51:57.824919 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:51:57.840570 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m11:51:57.840570 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.856181 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m11:51:57.856181 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m11:51:57.862700 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m11:51:57.878355 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m11:51:57.878355 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m11:51:57.878355 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m11:51:57.878355 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m11:51:57.893965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CA1C12E0>]}
[0m11:51:57.893965 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.24s]
[0m11:51:57.893965 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m11:51:57.893965 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m11:51:57.893965 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m11:51:57.903997 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m11:51:57.905428 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m11:51:57.910029 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:57.910029 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m11:51:57.955283 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:57.957742 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:57.962755 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m11:51:57.962755 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m11:51:58.241745 [debug] [Thread-3 (]: SQL status: BEGIN in 0.283 seconds
[0m11:51:58.241745 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:58.249854 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text normalization using the normalize_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase
    lower(review_text) as normalized_text,
    
    -- Remove punctuation and special characters
    regexp_replace(
        lower(review_text),
        '[^a-z0-9\s]',
        '',
        'g'
    ) as cleaned_text,
    
    -- Remove extra whitespace
    regexp_replace(
        regexp_replace(
            lower(review_text),
            '\s+',
            ' ',
            'g'
        ),
        '^\s+|\s+$',
        '',
        'g'
    ) as trimmed_text
,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        normalized_text,
        cleaned_text,
        trimmed_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m11:51:58.480635 [debug] [Thread-3 (]: SQL status: SELECT 4374 in 0.237 seconds
[0m11:51:58.496274 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:58.496274 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m11:51:58.496274 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:51:58.496274 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m11:51:58.496274 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:58.496274 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m11:51:58.496274 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m11:51:58.511906 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m11:51:58.511906 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m11:51:58.511906 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m11:51:58.511906 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m11:51:58.511906 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m11:51:58.511906 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '083f2e40-f46b-49a4-94e2-60190e908ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CF323320>]}
[0m11:51:58.511906 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public.int_bank_reviews ...................... [[32mSELECT 4374[0m in 0.62s]
[0m11:51:58.527526 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m11:51:58.527526 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:58.527526 [debug] [MainThread]: On master: BEGIN
[0m11:51:58.527526 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:51:58.609245 [debug] [MainThread]: SQL status: BEGIN in 0.084 seconds
[0m11:51:58.609245 [debug] [MainThread]: On master: COMMIT
[0m11:51:58.617250 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:58.617250 [debug] [MainThread]: On master: COMMIT
[0m11:51:58.617250 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:51:58.617250 [debug] [MainThread]: On master: Close
[0m11:51:58.617250 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:51:58.622012 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m11:51:58.622012 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m11:51:58.622012 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m11:51:58.622012 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m11:51:58.622012 [info ] [MainThread]: 
[0m11:51:58.622012 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.60 seconds (1.60s).
[0m11:51:58.622012 [debug] [MainThread]: Command end result
[0m11:51:58.759404 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m11:51:58.759404 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m11:51:58.776256 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m11:51:58.776435 [info ] [MainThread]: 
[0m11:51:58.776435 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:51:58.776435 [info ] [MainThread]: 
[0m11:51:58.780942 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m11:51:58.780942 [debug] [MainThread]: Command `dbt run` succeeded at 11:51:58.780942 after 6.99 seconds
[0m11:51:58.780942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CF362DE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CF362E10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234CF363B00>]}
[0m11:51:58.780942 [debug] [MainThread]: Flushing usage events
[0m11:51:59.489206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:02:20.605103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623C5AF620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623A677440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623A677800>]}


============================== 12:02:20.620748 | d316ce2e-861b-4924-bec2-ab6b893404c9 ==============================
[0m12:02:20.620748 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:02:20.620748 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:02:20.925139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623E151160>]}
[0m12:02:21.005839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623E1D3BF0>]}
[0m12:02:21.021486 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:02:21.399668 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:02:21.522515 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m12:02:21.522515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623CCBEEA0>]}
[0m12:02:24.713986 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:02:24.731982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623E990320>]}
[0m12:02:24.847561 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:02:24.847561 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:02:24.894419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623EA41FD0>]}
[0m12:02:24.894419 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:02:24.894419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623E824680>]}
[0m12:02:24.894419 [info ] [MainThread]: 
[0m12:02:24.894419 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:02:24.894419 [info ] [MainThread]: 
[0m12:02:24.906987 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:02:24.907947 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:02:25.039996 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:02:25.039996 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:02:25.039996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:02:25.111356 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.075 seconds
[0m12:02:25.111356 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:02:25.111356 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:02:25.132261 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:02:25.132261 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:02:25.132261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:02:25.203804 [debug] [ThreadPool]: SQL status: BEGIN in 0.076 seconds
[0m12:02:25.203804 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:02:25.203804 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:02:25.219429 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.009 seconds
[0m12:02:25.219429 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:02:25.219429 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:02:25.232459 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:25.232459 [debug] [MainThread]: On master: BEGIN
[0m12:02:25.232459 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:02:25.479669 [debug] [MainThread]: SQL status: BEGIN in 0.244 seconds
[0m12:02:25.479669 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:25.479669 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:02:25.495292 [debug] [MainThread]: SQL status: SELECT 1 in 0.012 seconds
[0m12:02:25.495292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623E876660>]}
[0m12:02:25.495292 [debug] [MainThread]: On master: ROLLBACK
[0m12:02:25.495292 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:25.495292 [debug] [MainThread]: On master: BEGIN
[0m12:02:25.495292 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:02:25.510918 [debug] [MainThread]: On master: COMMIT
[0m12:02:25.510918 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:25.510918 [debug] [MainThread]: On master: COMMIT
[0m12:02:25.510918 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:02:25.510918 [debug] [MainThread]: On master: Close
[0m12:02:25.510918 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:02:25.510918 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:02:25.510918 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:02:25.510918 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:02:25.533029 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.533029 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:02:25.649398 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.657948 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.657948 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:02:25.657948 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:02:25.732998 [debug] [Thread-1 (]: SQL status: BEGIN in 0.074 seconds
[0m12:02:25.732998 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.732998 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:02:25.732998 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m12:02:25.748661 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.748661 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:02:25.748661 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:02:25.764284 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.764284 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:02:25.764284 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:02:25.779886 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:02:25.779886 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.779886 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:02:25.779886 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:02:25.795535 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:02:25.795535 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:02:25.795535 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:02:25.811141 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:02:25.811141 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:02:25.811141 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262398E6B70>]}
[0m12:02:25.811141 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.30s]
[0m12:02:25.811141 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:02:25.811141 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:02:25.811141 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:02:25.811141 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:02:25.826783 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:02:25.876966 [debug] [Thread-3 (]: Compilation Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  'normalize_text' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m12:02:25.876966 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd316ce2e-861b-4924-bec2-ab6b893404c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623E93B110>]}
[0m12:02:25.876966 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.07s]
[0m12:02:25.876966 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:02:25.876966 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Compilation Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  'normalize_text' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m12:02:25.892763 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:25.892763 [debug] [MainThread]: On master: BEGIN
[0m12:02:25.892763 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:02:25.966509 [debug] [MainThread]: SQL status: BEGIN in 0.074 seconds
[0m12:02:25.966509 [debug] [MainThread]: On master: COMMIT
[0m12:02:25.966509 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:25.966509 [debug] [MainThread]: On master: COMMIT
[0m12:02:25.966509 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:02:25.966509 [debug] [MainThread]: On master: Close
[0m12:02:25.966509 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:02:25.975117 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:02:25.975117 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:02:25.975117 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:02:25.975117 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:02:25.975117 [info ] [MainThread]: 
[0m12:02:25.975117 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.07 seconds (1.07s).
[0m12:02:25.983126 [debug] [MainThread]: Command end result
[0m12:02:26.033582 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:02:26.044357 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:02:26.044357 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:02:26.044357 [info ] [MainThread]: 
[0m12:02:26.044357 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:02:26.044357 [info ] [MainThread]: 
[0m12:02:26.060080 [error] [MainThread]:   Compilation Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  'normalize_text' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m12:02:26.060080 [info ] [MainThread]: 
[0m12:02:26.060080 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:02:26.060080 [debug] [MainThread]: Command `dbt run` failed at 12:02:26.060080 after 5.67 seconds
[0m12:02:26.060080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623A54C860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623EAC3380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002623984D9A0>]}
[0m12:02:26.060080 [debug] [MainThread]: Flushing usage events
[0m12:02:26.851978 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:04:14.532801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA5E9D5010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA61575970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA5EEF2840>]}


============================== 12:04:14.532801 | 4f462a93-56cd-4b03-ab97-04e8c3a998dd ==============================
[0m12:04:14.532801 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:04:14.532801 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:04:14.818786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA61A22540>]}
[0m12:04:14.934708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA60EC2B40>]}
[0m12:04:14.934708 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:04:15.333248 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:04:15.664638 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:04:15.664638 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\intermediate\int_bank_reviews.sql
[0m12:04:15.981161 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:04:16.014843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA63435E80>]}
[0m12:04:16.131571 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:04:16.134605 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:04:16.165884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA63111FA0>]}
[0m12:04:16.165884 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:04:16.181498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA634A1520>]}
[0m12:04:16.181498 [info ] [MainThread]: 
[0m12:04:16.181498 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:04:16.181498 [info ] [MainThread]: 
[0m12:04:16.188307 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:04:16.195166 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:04:16.318044 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:04:16.318044 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:04:16.318044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:04:16.397204 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.078 seconds
[0m12:04:16.397204 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:04:16.397204 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:04:16.397204 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:04:16.397204 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:04:16.412829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:04:16.481864 [debug] [ThreadPool]: SQL status: BEGIN in 0.069 seconds
[0m12:04:16.481864 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:04:16.481864 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:04:16.481864 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.008 seconds
[0m12:04:16.481864 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:04:16.481864 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:04:16.513114 [debug] [MainThread]: Using postgres connection "master"
[0m12:04:16.513114 [debug] [MainThread]: On master: BEGIN
[0m12:04:16.513114 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:04:16.577041 [debug] [MainThread]: SQL status: BEGIN in 0.069 seconds
[0m12:04:16.585043 [debug] [MainThread]: Using postgres connection "master"
[0m12:04:16.585043 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:04:16.593605 [debug] [MainThread]: SQL status: SELECT 1 in 0.012 seconds
[0m12:04:16.593605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA63817B90>]}
[0m12:04:16.593605 [debug] [MainThread]: On master: ROLLBACK
[0m12:04:16.593605 [debug] [MainThread]: Using postgres connection "master"
[0m12:04:16.593605 [debug] [MainThread]: On master: BEGIN
[0m12:04:16.593605 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:04:16.593605 [debug] [MainThread]: On master: COMMIT
[0m12:04:16.593605 [debug] [MainThread]: Using postgres connection "master"
[0m12:04:16.593605 [debug] [MainThread]: On master: COMMIT
[0m12:04:16.593605 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:04:16.593605 [debug] [MainThread]: On master: Close
[0m12:04:16.609227 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:04:16.609227 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:04:16.609227 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:04:16.609227 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:04:16.625999 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:16.625999 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:04:16.676950 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:16.676950 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:16.676950 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:04:16.684954 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:04:16.742127 [debug] [Thread-1 (]: SQL status: BEGIN in 0.070 seconds
[0m12:04:16.742127 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:16.742127 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:04:16.935906 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.180 seconds
[0m12:04:16.958097 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:16.958097 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:04:16.958097 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:04:16.973715 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:16.973715 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:04:16.973715 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:04:17.004959 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:04:17.020586 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:17.020586 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:04:17.020586 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:04:17.020586 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:04:17.036207 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:04:17.036207 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:04:17.036207 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:04:17.042715 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:04:17.042715 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA5EAD1220>]}
[0m12:04:17.042715 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.43s]
[0m12:04:17.042715 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:04:17.042715 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:04:17.042715 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:04:17.042715 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:04:17.042715 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:04:17.060059 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.060059 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:04:17.167968 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.167968 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.167968 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:04:17.167968 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:04:17.230467 [debug] [Thread-3 (]: SQL status: BEGIN in 0.067 seconds
[0m12:04:17.242979 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.242979 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, and clean whitespace
    regexp_replace(
        regexp_replace(
            lower(review_text),
            '[^a-z0-9\s]',
            '',
            'g'
        ),
        '\s+',
        ' ',
        'g'
    ) as cleaned_text
,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:04:17.405807 [debug] [Thread-3 (]: SQL status: SELECT 4374 in 0.161 seconds
[0m12:04:17.405807 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.405807 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews" rename to "int_bank_reviews__dbt_backup"
[0m12:04:17.405807 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:04:17.421434 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.421434 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m12:04:17.421434 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:04:17.421434 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:04:17.421434 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.421434 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:04:17.421434 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m12:04:17.437078 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m12:04:17.443589 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:04:17.443589 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m12:04:17.443589 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m12:04:17.459229 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:04:17.459229 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f462a93-56cd-4b03-ab97-04e8c3a998dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA63C9A210>]}
[0m12:04:17.459229 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public.int_bank_reviews ...................... [[32mSELECT 4374[0m in 0.42s]
[0m12:04:17.459229 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:04:17.459229 [debug] [MainThread]: Using postgres connection "master"
[0m12:04:17.459229 [debug] [MainThread]: On master: BEGIN
[0m12:04:17.459229 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:04:17.543851 [debug] [MainThread]: SQL status: BEGIN in 0.080 seconds
[0m12:04:17.543851 [debug] [MainThread]: On master: COMMIT
[0m12:04:17.543851 [debug] [MainThread]: Using postgres connection "master"
[0m12:04:17.551852 [debug] [MainThread]: On master: COMMIT
[0m12:04:17.551852 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:04:17.551852 [debug] [MainThread]: On master: Close
[0m12:04:17.551852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:04:17.551852 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:04:17.551852 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:04:17.551852 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:04:17.551852 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:04:17.551852 [info ] [MainThread]: 
[0m12:04:17.551852 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.36 seconds (1.36s).
[0m12:04:17.559853 [debug] [MainThread]: Command end result
[0m12:04:17.610141 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:04:17.618138 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:04:17.626138 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:04:17.627269 [info ] [MainThread]: 
[0m12:04:17.627269 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:04:17.627269 [info ] [MainThread]: 
[0m12:04:17.627269 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m12:04:17.627269 [debug] [MainThread]: Command `dbt run` succeeded at 12:04:17.627269 after 3.25 seconds
[0m12:04:17.627269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA61782030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA6186BD70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA60E826C0>]}
[0m12:04:17.627269 [debug] [MainThread]: Flushing usage events
[0m12:04:18.393176 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:08:11.159225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143DE4D52E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E0F855E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E0EA92B0>]}


============================== 12:08:11.174862 | 60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a ==============================
[0m12:08:11.174862 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:08:11.174862 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:08:11.426976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143DE5D23F0>]}
[0m12:08:11.494508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E0AC8320>]}
[0m12:08:11.510108 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:08:11.892119 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:08:12.260292 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:08:12.260292 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:08:12.599749 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:08:12.621677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E2E952E0>]}
[0m12:08:12.737136 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:08:12.737136 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:08:12.768383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E2BF4EC0>]}
[0m12:08:12.768383 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:08:12.783988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E15D6F60>]}
[0m12:08:12.783988 [info ] [MainThread]: 
[0m12:08:12.783988 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:08:12.783988 [info ] [MainThread]: 
[0m12:08:12.783988 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:08:12.795629 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:08:12.903111 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:08:12.903111 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:08:12.903111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:12.994504 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.093 seconds
[0m12:08:12.994504 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:08:12.994504 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:08:13.010130 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:08:13.010130 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:08:13.010130 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:13.084163 [debug] [ThreadPool]: SQL status: BEGIN in 0.066 seconds
[0m12:08:13.084163 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:08:13.084163 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:08:13.084163 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.009 seconds
[0m12:08:13.099792 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:08:13.099792 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:08:13.115414 [debug] [MainThread]: Using postgres connection "master"
[0m12:08:13.115414 [debug] [MainThread]: On master: BEGIN
[0m12:08:13.115414 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:08:13.184448 [debug] [MainThread]: SQL status: BEGIN in 0.069 seconds
[0m12:08:13.184448 [debug] [MainThread]: Using postgres connection "master"
[0m12:08:13.184448 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:08:13.200062 [debug] [MainThread]: SQL status: SELECT 1 in 0.012 seconds
[0m12:08:13.200062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143DE6B0230>]}
[0m12:08:13.200062 [debug] [MainThread]: On master: ROLLBACK
[0m12:08:13.200062 [debug] [MainThread]: Using postgres connection "master"
[0m12:08:13.200062 [debug] [MainThread]: On master: BEGIN
[0m12:08:13.200062 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:08:13.200062 [debug] [MainThread]: On master: COMMIT
[0m12:08:13.200062 [debug] [MainThread]: Using postgres connection "master"
[0m12:08:13.200062 [debug] [MainThread]: On master: COMMIT
[0m12:08:13.200062 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:08:13.200062 [debug] [MainThread]: On master: Close
[0m12:08:13.215694 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:08:13.215694 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:08:13.215694 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:08:13.222230 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:08:13.222230 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.222230 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:08:13.280135 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.280135 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.280135 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:08:13.280135 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:08:13.353665 [debug] [Thread-1 (]: SQL status: BEGIN in 0.071 seconds
[0m12:08:13.353665 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.353665 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:08:13.369275 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m12:08:13.369275 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.369275 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:08:13.369275 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:08:13.384898 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.384898 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:08:13.384898 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:08:13.400522 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:08:13.400522 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.400522 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:08:13.416188 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m12:08:13.422697 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:08:13.422697 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:08:13.422697 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:08:13.438338 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:08:13.438338 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:08:13.438338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143DE5D1520>]}
[0m12:08:13.438338 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m12:08:13.438338 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:08:13.438338 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:08:13.438338 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:08:13.453957 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:08:13.453957 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:08:13.453957 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.453957 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:08:13.562812 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.570889 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.570889 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:08:13.570889 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:08:13.638455 [debug] [Thread-3 (]: SQL status: BEGIN in 0.069 seconds
[0m12:08:13.638455 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.638455 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace, and remove stop words
    regexp_replace(
        regexp_replace(
            regexp_replace(
                lower(review_text),
                '[^a-z0-9\s]',
                '',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        ),
        '\b(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|shall|should|can|could|may|might|must)\b',
        '',
        'g'
    ) as cleaned_text
,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:08:13.785660 [debug] [Thread-3 (]: SQL status: SELECT 4374 in 0.148 seconds
[0m12:08:13.801276 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.801276 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews" rename to "int_bank_reviews__dbt_backup"
[0m12:08:13.801276 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:08:13.801276 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.801276 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m12:08:13.801276 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:08:13.801276 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:08:13.801276 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.801276 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:08:13.823436 [debug] [Thread-3 (]: SQL status: COMMIT in 0.007 seconds
[0m12:08:13.823436 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m12:08:13.839111 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:08:13.839111 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m12:08:13.839111 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.008 seconds
[0m12:08:13.839111 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:08:13.854706 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60a178bb-34a8-4ada-a2d5-d7ba6dca6d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E37188F0>]}
[0m12:08:13.854706 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public.int_bank_reviews ...................... [[32mSELECT 4374[0m in 0.39s]
[0m12:08:13.854706 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:08:13.854706 [debug] [MainThread]: Using postgres connection "master"
[0m12:08:13.854706 [debug] [MainThread]: On master: BEGIN
[0m12:08:13.854706 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:08:13.953266 [debug] [MainThread]: SQL status: BEGIN in 0.094 seconds
[0m12:08:13.953266 [debug] [MainThread]: On master: COMMIT
[0m12:08:13.953266 [debug] [MainThread]: Using postgres connection "master"
[0m12:08:13.953266 [debug] [MainThread]: On master: COMMIT
[0m12:08:13.953266 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:08:13.953266 [debug] [MainThread]: On master: Close
[0m12:08:13.953266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:08:13.953266 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:08:13.953266 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:08:13.968891 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:08:13.968891 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:08:13.968891 [info ] [MainThread]: 
[0m12:08:13.968891 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m12:08:13.968891 [debug] [MainThread]: Command end result
[0m12:08:14.054459 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:08:14.063506 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:08:14.071509 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:08:14.071509 [info ] [MainThread]: 
[0m12:08:14.071509 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:08:14.071509 [info ] [MainThread]: 
[0m12:08:14.079509 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m12:08:14.079509 [debug] [MainThread]: Command `dbt run` succeeded at 12:08:14.079509 after 3.07 seconds
[0m12:08:14.079509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143DE4D52E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E2CAC500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000143E3379E80>]}
[0m12:08:14.079509 [debug] [MainThread]: Flushing usage events
[0m12:08:14.961280 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:11:18.912788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018421CE5190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018424885790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000184248857C0>]}


============================== 12:11:18.919305 | 4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1 ==============================
[0m12:11:18.919305 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:11:18.919305 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:11:19.166486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018424D20B00>]}
[0m12:11:19.252291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018424CEA690>]}
[0m12:11:19.252291 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:11:19.675449 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:11:20.014187 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:11:20.014187 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:11:20.346327 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:11:20.369087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018426185520>]}
[0m12:11:20.477088 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:11:20.477088 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:11:20.520864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000184264B8BF0>]}
[0m12:11:20.520864 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:11:20.520864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018426731FD0>]}
[0m12:11:20.520864 [info ] [MainThread]: 
[0m12:11:20.520864 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:11:20.520864 [info ] [MainThread]: 
[0m12:11:20.534868 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:11:20.540241 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:11:20.655353 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:11:20.655353 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:11:20.655353 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:11:20.906281 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.248 seconds
[0m12:11:20.906281 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:11:20.906281 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:11:20.921939 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:11:20.921939 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:11:20.921939 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:11:20.987995 [debug] [ThreadPool]: SQL status: BEGIN in 0.072 seconds
[0m12:11:20.987995 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:11:20.987995 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:11:21.006142 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.009 seconds
[0m12:11:21.006142 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:11:21.006142 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:11:21.021800 [debug] [MainThread]: Using postgres connection "master"
[0m12:11:21.021800 [debug] [MainThread]: On master: BEGIN
[0m12:11:21.021800 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:11:21.084278 [debug] [MainThread]: SQL status: BEGIN in 0.064 seconds
[0m12:11:21.084278 [debug] [MainThread]: Using postgres connection "master"
[0m12:11:21.099908 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:11:21.106423 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:11:21.106423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001842673B290>]}
[0m12:11:21.106423 [debug] [MainThread]: On master: ROLLBACK
[0m12:11:21.106423 [debug] [MainThread]: Using postgres connection "master"
[0m12:11:21.106423 [debug] [MainThread]: On master: BEGIN
[0m12:11:21.106423 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:11:21.106423 [debug] [MainThread]: On master: COMMIT
[0m12:11:21.106423 [debug] [MainThread]: Using postgres connection "master"
[0m12:11:21.106423 [debug] [MainThread]: On master: COMMIT
[0m12:11:21.106423 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:11:21.106423 [debug] [MainThread]: On master: Close
[0m12:11:21.122082 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:11:21.122082 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:11:21.122082 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:11:21.122082 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:11:21.138846 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.138846 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:11:21.197095 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.197095 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.197095 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:11:21.197095 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:11:21.261975 [debug] [Thread-1 (]: SQL status: BEGIN in 0.070 seconds
[0m12:11:21.261975 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.261975 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:11:21.277601 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m12:11:21.293237 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.293237 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:11:21.293237 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:11:21.293237 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.293237 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:11:21.293237 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:11:21.322438 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:11:21.322438 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.322438 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:11:21.322438 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:11:21.322438 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:11:21.338067 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:11:21.338067 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:11:21.338067 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:11:21.338067 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:11:21.338067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018421DE1580>]}
[0m12:11:21.353662 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m12:11:21.353662 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:11:21.353662 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:11:21.353662 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:11:21.353662 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:11:21.353662 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:11:21.353662 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.353662 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:11:21.472351 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.472351 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.472351 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:11:21.472351 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:11:21.538402 [debug] [Thread-3 (]: SQL status: BEGIN in 0.068 seconds
[0m12:11:21.538402 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.538402 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace, and remove stop words
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        lower(review_text),
                        '[^a-z0-9\s]',
                        '',
                        'g'
                    ),
                    '\s+',
                    ' ',
                    'g'
                ),
                '(\s|^)(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|shall|should|can|could|may|might|must)(\s|$)',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    ) as cleaned_text
,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:11:21.870636 [debug] [Thread-3 (]: SQL status: SELECT 4374 in 0.327 seconds
[0m12:11:21.880729 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.880729 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews" rename to "int_bank_reviews__dbt_backup"
[0m12:11:21.888792 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:11:21.890838 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.890838 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m12:11:21.890838 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:11:21.890838 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:11:21.890838 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.898944 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:11:21.898944 [debug] [Thread-3 (]: SQL status: COMMIT in 0.007 seconds
[0m12:11:21.908959 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m12:11:21.908959 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:11:21.908959 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m12:11:21.908959 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m12:11:21.924606 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:11:21.924606 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b6ef1d1-f81d-47ee-a94e-c5d3fe1c78b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000184267A8AD0>]}
[0m12:11:21.924606 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public.int_bank_reviews ...................... [[32mSELECT 4374[0m in 0.57s]
[0m12:11:21.924606 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:11:21.924606 [debug] [MainThread]: Using postgres connection "master"
[0m12:11:21.924606 [debug] [MainThread]: On master: BEGIN
[0m12:11:21.924606 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:11:22.009132 [debug] [MainThread]: SQL status: BEGIN in 0.078 seconds
[0m12:11:22.009132 [debug] [MainThread]: On master: COMMIT
[0m12:11:22.009132 [debug] [MainThread]: Using postgres connection "master"
[0m12:11:22.009132 [debug] [MainThread]: On master: COMMIT
[0m12:11:22.009132 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:11:22.009132 [debug] [MainThread]: On master: Close
[0m12:11:22.009132 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:11:22.009132 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:11:22.009132 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:11:22.009132 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:11:22.009132 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:11:22.009132 [info ] [MainThread]: 
[0m12:11:22.024793 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.47 seconds (1.47s).
[0m12:11:22.024793 [debug] [MainThread]: Command end result
[0m12:11:22.075399 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:11:22.075399 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:11:22.091078 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:11:22.091078 [info ] [MainThread]: 
[0m12:11:22.091078 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:11:22.091078 [info ] [MainThread]: 
[0m12:11:22.091078 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m12:11:22.091078 [debug] [MainThread]: Command `dbt run` succeeded at 12:11:22.091078 after 3.34 seconds
[0m12:11:22.105620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000184267501D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000184269DDD30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000184249392B0>]}
[0m12:11:22.109429 [debug] [MainThread]: Flushing usage events
[0m12:11:22.873762 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:20:37.196248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F12340F9B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F122D326F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F12340ECC0>]}


============================== 12:20:37.206566 | c3db1f0f-cb05-40af-8e11-68c46159d0f2 ==============================
[0m12:20:37.206566 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:20:37.206566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:20:37.554360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F123953B90>]}
[0m12:20:37.639026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F12376FD70>]}
[0m12:20:37.639026 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:20:38.036199 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:20:38.355902 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m12:20:38.355902 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:20:38.355902 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\intermediate\int_bank_reviews.sql
[0m12:20:38.726827 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:20:38.750259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F125265220>]}
[0m12:20:38.923377 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:20:38.934183 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:20:38.984174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F124FDCC80>]}
[0m12:20:38.984174 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:20:38.984174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1252D3BC0>]}
[0m12:20:38.984174 [info ] [MainThread]: 
[0m12:20:38.984174 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:20:38.992174 [info ] [MainThread]: 
[0m12:20:38.992174 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:20:38.992174 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:20:39.158855 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:20:39.158855 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:20:39.158855 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:39.242242 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.078 seconds
[0m12:20:39.244213 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:20:39.244213 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:20:39.251212 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:20:39.251212 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:20:39.251212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:39.534570 [debug] [ThreadPool]: SQL status: BEGIN in 0.282 seconds
[0m12:20:39.534570 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:20:39.543097 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:20:39.568010 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.024 seconds
[0m12:20:39.576009 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:20:39.576009 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:20:39.638353 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:39.641567 [debug] [MainThread]: On master: BEGIN
[0m12:20:39.641567 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:39.750948 [debug] [MainThread]: SQL status: BEGIN in 0.110 seconds
[0m12:20:39.750948 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:39.750948 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:20:39.767617 [debug] [MainThread]: SQL status: SELECT 1 in 0.012 seconds
[0m12:20:39.767617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F120A4BEC0>]}
[0m12:20:39.767617 [debug] [MainThread]: On master: ROLLBACK
[0m12:20:39.767617 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:39.767617 [debug] [MainThread]: On master: BEGIN
[0m12:20:39.767617 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:20:39.767617 [debug] [MainThread]: On master: COMMIT
[0m12:20:39.775619 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:39.775619 [debug] [MainThread]: On master: COMMIT
[0m12:20:39.775619 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:20:39.775619 [debug] [MainThread]: On master: Close
[0m12:20:39.775619 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:20:39.784340 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:20:39.784340 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:20:39.784340 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:20:39.791621 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.801028 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:20:39.853531 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.853531 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.853531 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:20:39.853531 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:20:39.941476 [debug] [Thread-1 (]: SQL status: BEGIN in 0.082 seconds
[0m12:20:39.941476 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.941476 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:20:39.951821 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m12:20:39.967620 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.967620 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:20:39.967620 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:20:39.967620 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.975630 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:20:39.977771 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:20:39.992232 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:20:39.992232 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:39.992232 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:20:40.001509 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m12:20:40.001509 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:20:40.017610 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:20:40.018946 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:20:40.018946 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:20:40.018946 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:20:40.026970 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1209A1700>]}
[0m12:20:40.026970 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m12:20:40.026970 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:20:40.035084 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:20:40.036522 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:20:40.036522 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:20:40.036522 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:20:40.051360 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:20:40.054957 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:20:40.291583 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:20:40.291704 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:20:40.291704 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:20:40.291704 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:20:40.349635 [debug] [Thread-3 (]: SQL status: BEGIN in 0.067 seconds
[0m12:20:40.349635 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:20:40.349635 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace, and remove stop words
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            lower(your_column),
                            '[^a-z0-9\s\']',  -- Keep apostrophes for contractions
                            '',
                            'g'
                        ),
                        '\s+',
                        ' ',
                        'g'
                    ),
                    -- Handle common contractions
                    'doesn\'t', 'does not',
                    'g'
                ),
                -- Remove only the most common stop words that don't add meaning
                '(\s|^)(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from)(\s|$)',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    ) as cleaned_text
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:20:40.365257 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  erreur de syntaxe sur ou près de « ] »
LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                  ^

[0m12:20:40.365257 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:20:40.365257 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:20:40.380884 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « ] »
  LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                    ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:20:40.380884 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3db1f0f-cb05-40af-8e11-68c46159d0f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1252030E0>]}
[0m12:20:40.380884 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.34s]
[0m12:20:40.380884 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:20:40.380884 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « ] »
  LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                    ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:20:40.380884 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:40.380884 [debug] [MainThread]: On master: BEGIN
[0m12:20:40.380884 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:40.458391 [debug] [MainThread]: SQL status: BEGIN in 0.074 seconds
[0m12:20:40.458391 [debug] [MainThread]: On master: COMMIT
[0m12:20:40.458391 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:40.458391 [debug] [MainThread]: On master: COMMIT
[0m12:20:40.458391 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:20:40.458391 [debug] [MainThread]: On master: Close
[0m12:20:40.474022 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:40.474022 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:20:40.474022 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:20:40.474022 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:20:40.474022 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:20:40.474022 [info ] [MainThread]: 
[0m12:20:40.474022 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m12:20:40.474022 [debug] [MainThread]: Command end result
[0m12:20:40.536246 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:20:40.536246 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:20:40.550954 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:20:40.550954 [info ] [MainThread]: 
[0m12:20:40.550954 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:20:40.558955 [info ] [MainThread]: 
[0m12:20:40.558955 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « ] »
  LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                    ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:20:40.567754 [info ] [MainThread]: 
[0m12:20:40.567754 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:20:40.567754 [debug] [MainThread]: Command `dbt run` failed at 12:20:40.567754 after 3.55 seconds
[0m12:20:40.567754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F122A82F00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1252DAD80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F12379A480>]}
[0m12:20:40.567754 [debug] [MainThread]: Flushing usage events
[0m12:20:41.528541 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:24:37.884952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F879F6B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F8E80D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F8E800E0>]}


============================== 12:24:37.900599 | 4968169c-45ad-4a2f-b2b3-d2b8806428f3 ==============================
[0m12:24:37.900599 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:24:37.900599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:24:38.157506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F93F0170>]}
[0m12:24:38.233227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F9326F90>]}
[0m12:24:38.241315 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:24:38.633928 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:24:38.936834 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:24:38.936834 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:24:39.292377 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:24:39.312583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202FAD52330>]}
[0m12:24:39.426734 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:24:39.426734 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:24:39.469174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202FA9B3E60>]}
[0m12:24:39.469174 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:24:39.469174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202FAD53A70>]}
[0m12:24:39.469174 [info ] [MainThread]: 
[0m12:24:39.469174 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:24:39.469174 [info ] [MainThread]: 
[0m12:24:39.481399 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:24:39.489229 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:24:39.603029 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:24:39.603029 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:24:39.603029 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:24:39.672979 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.075 seconds
[0m12:24:39.672979 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:24:39.672979 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:24:39.688603 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:24:39.688603 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:24:39.688603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:24:39.757617 [debug] [ThreadPool]: SQL status: BEGIN in 0.068 seconds
[0m12:24:39.757617 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:24:39.757617 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:24:39.773243 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.009 seconds
[0m12:24:39.773243 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:24:39.773243 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:24:39.804490 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:39.804490 [debug] [MainThread]: On master: BEGIN
[0m12:24:39.804490 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:24:39.873539 [debug] [MainThread]: SQL status: BEGIN in 0.069 seconds
[0m12:24:39.873539 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:39.873539 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:24:39.889154 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:24:39.889154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F64EB8F0>]}
[0m12:24:39.889154 [debug] [MainThread]: On master: ROLLBACK
[0m12:24:39.889154 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:39.889154 [debug] [MainThread]: On master: BEGIN
[0m12:24:39.889154 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:24:39.889154 [debug] [MainThread]: On master: COMMIT
[0m12:24:39.889154 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:39.889154 [debug] [MainThread]: On master: COMMIT
[0m12:24:39.889154 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:24:39.889154 [debug] [MainThread]: On master: Close
[0m12:24:39.904772 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:24:39.904772 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:24:39.904772 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:24:39.904772 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:24:39.923756 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:39.923756 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:24:39.970397 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:39.978400 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:39.978400 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:24:39.978400 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:24:40.221248 [debug] [Thread-1 (]: SQL status: BEGIN in 0.249 seconds
[0m12:24:40.221248 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:40.221248 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:24:40.243405 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m12:24:40.243405 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:40.243405 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:24:40.243405 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:40.259048 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:40.259048 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:24:40.259048 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:40.274673 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:24:40.274673 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:40.274673 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:24:40.274673 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:24:40.290296 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:24:40.290296 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:24:40.305917 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:24:40.305917 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:24:40.305917 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:24:40.305917 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F64414F0>]}
[0m12:24:40.305917 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.40s]
[0m12:24:40.321541 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:24:40.321541 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:24:40.321541 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:24:40.327383 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:24:40.328129 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:24:40.338731 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:24:40.343242 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:24:40.427776 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:24:40.443312 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:24:40.443312 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:24:40.443312 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:24:40.690787 [debug] [Thread-3 (]: SQL status: BEGIN in 0.248 seconds
[0m12:24:40.690787 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:24:40.690787 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            regexp_replace(
                                regexp_replace(
                                    regexp_replace(
                                        regexp_replace(
                                            regexp_replace(
                                                lower(coalesce(your_column, '')),
                                                -- Remove URLs and email addresses
                                                'https?://[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',
                                                '',
                                                'g'
                                            ),
                                            -- Remove numbers and special characters, keep only letters and spaces
                                            '[^a-zA-ZÀ-ÿ\u0600-\u06FF\\s]',
                                            ' ',
                                            'g'
                                        ),
                                        -- Normalize multiple spaces
                                        '\\s+',
                                        ' ',
                                        'g'
                                    ),
                                    -- Remove English stop words
                                    '\\m(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|this|that|these|those|a|an|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|may|might|must|shall|can|dont|doesnt|wont|cant|isnt|arent|wasnt|werent)\\M',
                                    ' ',
                                    'gi'
                                ),
                                -- Remove Arabic stop words
                                '\\m(في|من|إلى|على|عن|مع|هذا|هذه|ذلك|تلك|التي|الذي|كان|كانت|يكون|تكون)\\M',
                                ' ',
                                'g'
                            ),
                            -- Remove French stop words
                            '\\m(le|la|les|de|du|des|un|une|et|ou|mais|dans|sur|avec|par|pour|sans|sous|ce|cette|ces|qui|que|dont|où|est|sont|était|étaient|être|avoir|avait|avaient)\\M',
                            ' ',
                            'gi'
                        ),
                        -- Remove very short words (1-2 characters)
                        '\\m[a-zA-Z]{1,2}\\M',
                        ' ',
                        'g'
                    ),
                    -- Final cleanup of multiple spaces
                    '\\s+',
                    ' ',
                    'g'
                ),
                -- Trim leading/trailing spaces
                '^\\s+|\\s+$',
                '',
                'g'
            )
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:24:40.690787 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  la colonne « your_column » n'existe pas
LINE 51: ...                                   lower(coalesce(your_colum...
                                                              ^

[0m12:24:40.706408 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:24:40.706408 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:24:40.722031 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la colonne « your_column » n'existe pas
  LINE 51: ...                                   lower(coalesce(your_colum...
                                                                ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:24:40.722031 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4968169c-45ad-4a2f-b2b3-d2b8806428f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202FB107FB0>]}
[0m12:24:40.737652 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.40s]
[0m12:24:40.737652 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:24:40.744177 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la colonne « your_column » n'existe pas
  LINE 51: ...                                   lower(coalesce(your_colum...
                                                                ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:24:40.744177 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:40.744177 [debug] [MainThread]: On master: BEGIN
[0m12:24:40.744177 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:24:40.827836 [debug] [MainThread]: SQL status: BEGIN in 0.089 seconds
[0m12:24:40.827836 [debug] [MainThread]: On master: COMMIT
[0m12:24:40.827836 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:40.827836 [debug] [MainThread]: On master: COMMIT
[0m12:24:40.827836 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:24:40.827836 [debug] [MainThread]: On master: Close
[0m12:24:40.827836 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:24:40.844478 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:24:40.844478 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:24:40.844478 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:24:40.844478 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:24:40.844478 [info ] [MainThread]: 
[0m12:24:40.844478 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.36 seconds (1.36s).
[0m12:24:40.844478 [debug] [MainThread]: Command end result
[0m12:24:40.960868 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:24:40.960868 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:24:40.976497 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:24:40.976497 [info ] [MainThread]: 
[0m12:24:40.976497 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:24:40.976497 [info ] [MainThread]: 
[0m12:24:40.976497 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la colonne « your_column » n'existe pas
  LINE 51: ...                                   lower(coalesce(your_colum...
                                                                ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:24:40.976497 [info ] [MainThread]: 
[0m12:24:40.976497 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:24:40.988181 [debug] [MainThread]: Command `dbt run` failed at 12:24:40.988181 after 3.25 seconds
[0m12:24:40.990695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F91207A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F8C9C860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F8E80D10>]}
[0m12:24:40.991619 [debug] [MainThread]: Flushing usage events
[0m12:24:41.809845 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:26:24.795106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021299A11040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021299A13DA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129638DB50>]}


============================== 12:26:24.795106 | fbb3fe8b-c18f-4e42-b5fc-594e9557b308 ==============================
[0m12:26:24.795106 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:26:24.795106 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:26:25.048433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021299CD1160>]}
[0m12:26:25.133093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021299D95730>]}
[0m12:26:25.133093 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:26:25.527396 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:26:25.854594 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:26:25.854594 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\intermediate\int_bank_reviews.sql
[0m12:26:26.186797 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:26:26.207511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129B17D6A0>]}
[0m12:26:26.335550 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:26:26.340065 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:26:26.371327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129B3AE510>]}
[0m12:26:26.371327 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:26:26.371327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129B73D700>]}
[0m12:26:26.371327 [info ] [MainThread]: 
[0m12:26:26.371327 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:26:26.371327 [info ] [MainThread]: 
[0m12:26:26.371327 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:26:26.391805 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:26:26.496340 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:26:26.496340 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:26:26.496340 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:26:26.571866 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.072 seconds
[0m12:26:26.571866 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:26:26.571866 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:26:26.587490 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:26:26.587490 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:26:26.587490 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:26:26.856484 [debug] [ThreadPool]: SQL status: BEGIN in 0.261 seconds
[0m12:26:26.856484 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:26:26.856484 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:26:26.856484 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.010 seconds
[0m12:26:26.872107 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:26:26.872107 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:26:26.887749 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:26.887749 [debug] [MainThread]: On master: BEGIN
[0m12:26:26.887749 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:26:26.956743 [debug] [MainThread]: SQL status: BEGIN in 0.065 seconds
[0m12:26:26.956743 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:26.956743 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:26:26.956743 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m12:26:26.972372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129BAA77A0>]}
[0m12:26:26.972372 [debug] [MainThread]: On master: ROLLBACK
[0m12:26:26.972372 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:26.972372 [debug] [MainThread]: On master: BEGIN
[0m12:26:26.972372 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:26:26.972372 [debug] [MainThread]: On master: COMMIT
[0m12:26:26.972372 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:26.972372 [debug] [MainThread]: On master: COMMIT
[0m12:26:26.972372 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:26:26.972372 [debug] [MainThread]: On master: Close
[0m12:26:26.972372 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:26:26.972372 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:26:26.987994 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:26:26.987994 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:26:26.987994 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.003627 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:26:27.056608 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.056608 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.056608 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:26:27.056608 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:26:27.127562 [debug] [Thread-1 (]: SQL status: BEGIN in 0.070 seconds
[0m12:26:27.127562 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.127562 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:26:27.141591 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m12:26:27.141591 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.141591 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:26:27.141591 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:26:27.172864 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.172864 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:26:27.172864 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:26:27.188506 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:26:27.188506 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.188506 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:26:27.188506 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:26:27.204126 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:26:27.204126 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:26:27.204126 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:26:27.219733 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:26:27.219733 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:26:27.219733 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021296D91670>]}
[0m12:26:27.219733 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m12:26:27.219733 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:26:27.219733 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:26:27.219733 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:26:27.235353 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:26:27.235353 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:26:27.235353 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:26:27.241889 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:26:27.349911 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:26:27.349911 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:26:27.349911 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:26:27.349911 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:26:27.437198 [debug] [Thread-3 (]: SQL status: BEGIN in 0.084 seconds
[0m12:26:27.437198 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:26:27.437198 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            regexp_replace(
                                regexp_replace(
                                    regexp_replace(
                                        regexp_replace(
                                            regexp_replace(
                                                lower(coalesce(review_text, '')),
                                                -- Remove URLs and email addresses
                                                'https?://[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',
                                                '',
                                                'g'
                                            ),
                                            -- Remove numbers and special characters, keep only letters and spaces
                                            '[^a-zA-ZÀ-ÿ\u0600-\u06FF\\s]',
                                            ' ',
                                            'g'
                                        ),
                                        -- Normalize multiple spaces
                                        '\\s+',
                                        ' ',
                                        'g'
                                    ),
                                    -- Remove English stop words
                                    '\\m(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|this|that|these|those|a|an|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|may|might|must|shall|can|dont|doesnt|wont|cant|isnt|arent|wasnt|werent)\\M',
                                    ' ',
                                    'gi'
                                ),
                                -- Remove Arabic stop words
                                '\\m(في|من|إلى|على|عن|مع|هذا|هذه|ذلك|تلك|التي|الذي|كان|كانت|يكون|تكون)\\M',
                                ' ',
                                'g'
                            ),
                            -- Remove French stop words
                            '\\m(le|la|les|de|du|des|un|une|et|ou|mais|dans|sur|avec|par|pour|sans|sous|ce|cette|ces|qui|que|dont|où|est|sont|était|étaient|être|avoir|avait|avaient)\\M',
                            ' ',
                            'gi'
                        ),
                        -- Remove very short words (1-2 characters)
                        '\\m[a-zA-Z]{1,2}\\M',
                        ' ',
                        'g'
                    ),
                    -- Final cleanup of multiple spaces
                    '\\s+',
                    ' ',
                    'g'
                ),
                -- Trim leading/trailing spaces
                '^\\s+|\\s+$',
                '',
                'g'
            )
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:26:27.441730 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  la fonction regexp_replace(text) n'existe pas
LINE 41:         regexp_replace(
                 ^
HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
Vous devez ajouter des conversions explicites de type.

[0m12:26:27.441730 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:26:27.441730 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:26:27.457367 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:26:27.457367 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbb3fe8b-c18f-4e42-b5fc-594e9557b308', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021296E70470>]}
[0m12:26:27.457367 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.24s]
[0m12:26:27.457367 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:26:27.457367 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:26:27.457367 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:27.457367 [debug] [MainThread]: On master: BEGIN
[0m12:26:27.457367 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:26:27.547278 [debug] [MainThread]: SQL status: BEGIN in 0.083 seconds
[0m12:26:27.547278 [debug] [MainThread]: On master: COMMIT
[0m12:26:27.547278 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:27.547278 [debug] [MainThread]: On master: COMMIT
[0m12:26:27.547278 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:26:27.547278 [debug] [MainThread]: On master: Close
[0m12:26:27.547278 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:26:27.547278 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:26:27.547278 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:26:27.547278 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:26:27.547278 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:26:27.547278 [info ] [MainThread]: 
[0m12:26:27.547278 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m12:26:27.547278 [debug] [MainThread]: Command end result
[0m12:26:27.608896 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:26:27.608896 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:26:27.624798 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:26:27.624798 [info ] [MainThread]: 
[0m12:26:27.624798 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:26:27.624798 [info ] [MainThread]: 
[0m12:26:27.624798 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:26:27.624798 [info ] [MainThread]: 
[0m12:26:27.639496 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:26:27.639496 [debug] [MainThread]: Command `dbt run` failed at 12:26:27.639496 after 2.99 seconds
[0m12:26:27.644970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021299A70F80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129979E270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002129979E210>]}
[0m12:26:27.647483 [debug] [MainThread]: Flushing usage events
[0m12:26:28.646870 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:28:43.799727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9853A40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9853710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9853770>]}


============================== 12:28:43.815376 | 3e9d4eeb-f7d2-4788-8dea-553156359820 ==============================
[0m12:28:43.815376 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:28:43.815376 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:28:44.068950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9D92DB0>]}
[0m12:28:44.162513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9DE5520>]}
[0m12:28:44.162513 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:28:44.590873 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:28:44.923078 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:28:44.923078 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:28:44.938718 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:28:44.990756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8FB0E0C50>]}
[0m12:28:45.117609 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:28:45.123643 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:28:45.171983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8FB100530>]}
[0m12:28:45.171983 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:28:45.180001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8FB326270>]}
[0m12:28:45.180001 [info ] [MainThread]: 
[0m12:28:45.180001 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:28:45.180001 [info ] [MainThread]: 
[0m12:28:45.180001 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:28:45.187978 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:28:45.343596 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:28:45.343596 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:28:45.343596 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:45.455288 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.107 seconds
[0m12:28:45.461190 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:28:45.461190 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:28:45.479945 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:28:45.479945 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:28:45.479945 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:45.571898 [debug] [ThreadPool]: SQL status: BEGIN in 0.094 seconds
[0m12:28:45.571898 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:28:45.571898 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:28:45.587894 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.008 seconds
[0m12:28:45.587894 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:28:45.587894 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:28:45.606964 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:45.606964 [debug] [MainThread]: On master: BEGIN
[0m12:28:45.606964 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:28:45.678595 [debug] [MainThread]: SQL status: BEGIN in 0.072 seconds
[0m12:28:45.678595 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:45.678595 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:28:45.694222 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:28:45.694222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8FB8DC770>]}
[0m12:28:45.694222 [debug] [MainThread]: On master: ROLLBACK
[0m12:28:45.694222 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:45.694222 [debug] [MainThread]: On master: BEGIN
[0m12:28:45.709842 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:28:45.709842 [debug] [MainThread]: On master: COMMIT
[0m12:28:45.709842 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:45.709842 [debug] [MainThread]: On master: COMMIT
[0m12:28:45.709842 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:28:45.709842 [debug] [MainThread]: On master: Close
[0m12:28:45.709842 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:28:45.709842 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:28:45.709842 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:28:45.709842 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:28:45.724375 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:45.724375 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:28:45.788923 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:45.788923 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:45.788923 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:28:45.788923 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:28:46.018165 [debug] [Thread-1 (]: SQL status: BEGIN in 0.227 seconds
[0m12:28:46.018165 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:46.024682 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:28:46.024682 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m12:28:46.040329 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:46.040329 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:28:46.040329 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:28:46.055953 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:46.055953 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:28:46.055953 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:28:46.071586 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:28:46.071586 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:46.071586 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:28:46.087215 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m12:28:46.087215 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:28:46.102829 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:28:46.102829 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:28:46.102829 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:28:46.102829 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:28:46.102829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8FB98B350>]}
[0m12:28:46.102829 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.39s]
[0m12:28:46.118449 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:28:46.118449 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:28:46.118449 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:28:46.118449 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:28:46.118449 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:28:46.124963 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:28:46.124963 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:28:46.171889 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:28:46.171889 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:28:46.171889 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:28:46.171889 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:28:46.241228 [debug] [Thread-3 (]: SQL status: BEGIN in 0.077 seconds
[0m12:28:46.241228 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:28:46.256854 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            regexp_replace(
                                regexp_replace(
                                    regexp_replace(
                                        regexp_replace(
                                            regexp_replace(
                                                lower(coalesce(review_text, '')),
                                                -- Remove URLs and email addresses
                                                'https?://[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',
                                                '',
                                                'g'
                                            ),
                                            -- Remove numbers and special characters, keep only letters and spaces
                                            '[^a-zA-ZÀ-ÿ\u0600-\u06FF\\s]',
                                            ' ',
                                            'g'
                                        ),
                                        -- Normalize multiple spaces
                                        '\\s+',
                                        ' ',
                                        'g'
                                    ),
                                    -- Remove English stop words
                                    '\\m(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|this|that|these|those|a|an|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|may|might|must|shall|can|dont|doesnt|wont|cant|isnt|arent|wasnt|werent)\\M',
                                    ' ',
                                    'gi'
                                ),
                                -- Remove Arabic stop words
                                '\\m(في|من|إلى|على|عن|مع|هذا|هذه|ذلك|تلك|التي|الذي|كان|كانت|يكون|تكون)\\M',
                                ' ',
                                'g'
                            ),
                            -- Remove French stop words
                            '\\m(le|la|les|de|du|des|un|une|et|ou|mais|dans|sur|avec|par|pour|sans|sous|ce|cette|ces|qui|que|dont|où|est|sont|était|étaient|être|avoir|avait|avaient)\\M',
                            ' ',
                            'gi'
                        ),
                        -- Remove very short words (1-2 characters)
                        '\\m[a-zA-Z]{1,2}\\M',
                        ' ',
                        'g'
                    ),
                    -- Final cleanup of multiple spaces
                    '\\s+',
                    ' ',
                    'g'
                ),
                -- Trim leading/trailing spaces
                '^\\s+|\\s+$',
                '',
                'g'
            )
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:28:46.256854 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  la fonction regexp_replace(text) n'existe pas
LINE 41:         regexp_replace(
                 ^
HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
Vous devez ajouter des conversions explicites de type.

[0m12:28:46.256854 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:28:46.256854 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:28:46.272479 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:28:46.272479 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e9d4eeb-f7d2-4788-8dea-553156359820', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8FB12F350>]}
[0m12:28:46.272479 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.15s]
[0m12:28:46.272479 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:28:46.272479 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:28:46.272479 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:46.272479 [debug] [MainThread]: On master: BEGIN
[0m12:28:46.272479 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:28:46.362910 [debug] [MainThread]: SQL status: BEGIN in 0.080 seconds
[0m12:28:46.362910 [debug] [MainThread]: On master: COMMIT
[0m12:28:46.362910 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:46.362910 [debug] [MainThread]: On master: COMMIT
[0m12:28:46.362910 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:28:46.362910 [debug] [MainThread]: On master: Close
[0m12:28:46.362910 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:28:46.362910 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:28:46.362910 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:28:46.362910 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:28:46.362910 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:28:46.362910 [info ] [MainThread]: 
[0m12:28:46.362910 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m12:28:46.362910 [debug] [MainThread]: Command end result
[0m12:28:46.445096 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:28:46.455115 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:28:46.463113 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:28:46.463113 [info ] [MainThread]: 
[0m12:28:46.463113 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:28:46.463113 [info ] [MainThread]: 
[0m12:28:46.471110 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:28:46.471110 [info ] [MainThread]: 
[0m12:28:46.477265 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:28:46.477265 [debug] [MainThread]: Command `dbt run` failed at 12:28:46.477265 after 2.82 seconds
[0m12:28:46.477265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9BDC1D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9BDC230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8F9BDFB00>]}
[0m12:28:46.477265 [debug] [MainThread]: Flushing usage events
[0m12:28:47.855024 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:31:41.319022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA46382C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA49F30B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA49F25D0>]}


============================== 12:31:41.334651 | f22e243e-4cd9-40fd-a58d-4d2735bc0084 ==============================
[0m12:31:41.334651 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:31:41.334651 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:31:41.612095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA4EB0F80>]}
[0m12:31:41.698507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA4B89280>]}
[0m12:31:41.698507 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:31:42.096068 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:31:42.428139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:31:42.428139 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:31:42.759204 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:31:42.784319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA68825A0>]}
[0m12:31:42.907777 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:31:42.916114 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:31:42.951384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA64E1460>]}
[0m12:31:42.951384 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:31:42.951384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA65712B0>]}
[0m12:31:42.951384 [info ] [MainThread]: 
[0m12:31:42.951384 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:31:42.951384 [info ] [MainThread]: 
[0m12:31:42.951384 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:31:42.967561 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:31:43.082962 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:31:43.082962 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:31:43.082962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:31:43.151472 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.074 seconds
[0m12:31:43.167111 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:31:43.167111 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:31:43.182737 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:31:43.182737 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:31:43.182737 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:31:43.251749 [debug] [ThreadPool]: SQL status: BEGIN in 0.067 seconds
[0m12:31:43.251749 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:31:43.251749 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:31:43.251749 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.008 seconds
[0m12:31:43.251749 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:31:43.267386 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:31:43.290819 [debug] [MainThread]: Using postgres connection "master"
[0m12:31:43.290819 [debug] [MainThread]: On master: BEGIN
[0m12:31:43.290819 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:31:43.351766 [debug] [MainThread]: SQL status: BEGIN in 0.068 seconds
[0m12:31:43.351766 [debug] [MainThread]: Using postgres connection "master"
[0m12:31:43.351766 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:31:43.367406 [debug] [MainThread]: SQL status: SELECT 1 in 0.012 seconds
[0m12:31:43.367406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA4F5B320>]}
[0m12:31:43.367406 [debug] [MainThread]: On master: ROLLBACK
[0m12:31:43.367406 [debug] [MainThread]: Using postgres connection "master"
[0m12:31:43.367406 [debug] [MainThread]: On master: BEGIN
[0m12:31:43.383029 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:31:43.383029 [debug] [MainThread]: On master: COMMIT
[0m12:31:43.383029 [debug] [MainThread]: Using postgres connection "master"
[0m12:31:43.383029 [debug] [MainThread]: On master: COMMIT
[0m12:31:43.383029 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:31:43.383029 [debug] [MainThread]: On master: Close
[0m12:31:43.383029 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:31:43.383029 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:31:43.383029 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:31:43.383029 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:31:43.398656 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.398656 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:31:43.452043 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.452043 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.466739 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:31:43.466739 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:31:43.522880 [debug] [Thread-1 (]: SQL status: BEGIN in 0.065 seconds
[0m12:31:43.522880 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.522880 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:31:43.538490 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m12:31:43.552028 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.552028 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:31:43.552028 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:31:43.552028 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.552028 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:31:43.552028 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:31:43.583292 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:31:43.583292 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.583292 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:31:43.583292 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m12:31:43.598944 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:31:43.598944 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:31:43.614572 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:31:43.614572 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:31:43.614572 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:31:43.614572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA1F81520>]}
[0m12:31:43.614572 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m12:31:43.614572 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:31:43.614572 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:31:43.630166 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:31:43.633029 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:31:43.634377 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:31:43.634634 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:31:43.634634 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:31:43.740387 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:31:43.740387 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:31:43.752418 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:31:43.752418 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:31:43.815984 [debug] [Thread-3 (]: SQL status: BEGIN in 0.071 seconds
[0m12:31:43.815984 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:31:43.815984 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            regexp_replace(
                                regexp_replace(
                                    regexp_replace(
                                        regexp_replace(
                                            regexp_replace(
                                                lower(coalesce(review_text, '')),
                                                -- Remove URLs and email addresses
                                                'https?://[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',
                                                '',
                                                'g'
                                            ),
                                            '[^a-zA-ZÀ-ÿ\u0600-\u06FF\\s]',
                                            ' ',
                                            'g'
                                        ),
                                        '\\s+',
                                        ' ',
                                        'g'
                                    ),
                                    '\\m(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|this|that|these|those|a|an|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|may|might|must|shall|can|dont|doesnt|wont|cant|isnt|arent|wasnt|werent)\\M',
                                    ' ',
                                    'gi'
                                ),
                                '\\m(في|من|إلى|على|عن|مع|هذا|هذه|ذلك|تلك|التي|الذي|كان|كانت|يكون|تكون)\\M',
                                ' ',
                                'g'
                            ),
                            '\\m(le|la|les|de|du|des|un|une|et|ou|mais|dans|sur|avec|par|pour|sans|sous|ce|cette|ces|qui|que|dont|où|est|sont|était|étaient|être|avoir|avait|avaient)\\M',
                            ' ',
                            'gi'
                        ),
                        '\\m[a-zA-Z]{1,2}\\M',
                        ' ',
                        'g'
                    ),
                    '\\s+',
                    ' ',
                    'g'
                ),
                '^\\s+|\\s+$',
                '',
                'g'
            )
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:31:43.815984 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  la fonction regexp_replace(text) n'existe pas
LINE 41:         regexp_replace(
                 ^
HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
Vous devez ajouter des conversions explicites de type.

[0m12:31:43.815984 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:31:43.815984 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:31:43.831612 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:31:43.831612 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f22e243e-4cd9-40fd-a58d-4d2735bc0084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA1E81310>]}
[0m12:31:43.831612 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.20s]
[0m12:31:43.831612 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:31:43.831612 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:31:43.831612 [debug] [MainThread]: Using postgres connection "master"
[0m12:31:43.831612 [debug] [MainThread]: On master: BEGIN
[0m12:31:43.847254 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:31:43.915702 [debug] [MainThread]: SQL status: BEGIN in 0.075 seconds
[0m12:31:43.915702 [debug] [MainThread]: On master: COMMIT
[0m12:31:43.923770 [debug] [MainThread]: Using postgres connection "master"
[0m12:31:43.923770 [debug] [MainThread]: On master: COMMIT
[0m12:31:43.923770 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:31:43.923770 [debug] [MainThread]: On master: Close
[0m12:31:43.923770 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:31:43.923770 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:31:43.923770 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:31:43.923770 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:31:43.923770 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:31:43.923770 [info ] [MainThread]: 
[0m12:31:43.923770 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m12:31:43.923770 [debug] [MainThread]: Command end result
[0m12:31:43.984900 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:31:43.999314 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:31:44.007312 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:31:44.007312 [info ] [MainThread]: 
[0m12:31:44.007312 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:31:44.015310 [info ] [MainThread]: 
[0m12:31:44.016253 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  la fonction regexp_replace(text) n'existe pas
  LINE 41:         regexp_replace(
                   ^
  HINT:  Aucune fonction ne correspond au nom donné et aux types d'arguments.
  Vous devez ajouter des conversions explicites de type.
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:31:44.019108 [info ] [MainThread]: 
[0m12:31:44.019108 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:31:44.019108 [debug] [MainThread]: Command `dbt run` failed at 12:31:44.019108 after 2.84 seconds
[0m12:31:44.019108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA662A030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA472EF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002FBA472F1A0>]}
[0m12:31:44.019108 [debug] [MainThread]: Flushing usage events
[0m12:31:44.805771 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:32:19.344988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B43741E6F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B4348B1460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B436DA0170>]}


============================== 12:32:19.352995 | 8d2f35b1-826e-4fa3-a08f-ecca44c66405 ==============================
[0m12:32:19.352995 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:32:19.352995 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:32:19.819503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B4378E11C0>]}
[0m12:32:19.961892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B4376926F0>]}
[0m12:32:19.961892 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:32:20.378781 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:32:20.713247 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:32:20.713247 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:32:21.360869 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:32:21.385605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B43927C710>]}
[0m12:32:21.515966 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:32:21.527882 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:32:21.578226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B438F7C4D0>]}
[0m12:32:21.578226 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:32:21.578226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B4392739E0>]}
[0m12:32:21.578226 [info ] [MainThread]: 
[0m12:32:21.578226 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:32:21.578226 [info ] [MainThread]: 
[0m12:32:21.586228 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:32:21.596734 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:32:21.752849 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:32:21.752849 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:32:21.755528 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:32:21.862277 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.110 seconds
[0m12:32:21.862277 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:32:21.862277 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:32:21.878768 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:32:21.878768 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:32:21.878768 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:32:21.993466 [debug] [ThreadPool]: SQL status: BEGIN in 0.106 seconds
[0m12:32:21.993466 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:32:21.993466 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:32:22.009088 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.011 seconds
[0m12:32:22.009088 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:32:22.009088 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:32:22.028223 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:22.028223 [debug] [MainThread]: On master: BEGIN
[0m12:32:22.028223 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:32:22.114920 [debug] [MainThread]: SQL status: BEGIN in 0.077 seconds
[0m12:32:22.114920 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:22.114920 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:32:22.132987 [debug] [MainThread]: SQL status: SELECT 1 in 0.013 seconds
[0m12:32:22.132987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B438E73E90>]}
[0m12:32:22.132987 [debug] [MainThread]: On master: ROLLBACK
[0m12:32:22.132987 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:22.132987 [debug] [MainThread]: On master: BEGIN
[0m12:32:22.132987 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:32:22.132987 [debug] [MainThread]: On master: COMMIT
[0m12:32:22.132987 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:22.132987 [debug] [MainThread]: On master: COMMIT
[0m12:32:22.144451 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:32:22.144451 [debug] [MainThread]: On master: Close
[0m12:32:22.152451 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:32:22.152451 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:32:22.152451 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:32:22.152451 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:32:22.168449 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.168449 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:32:22.255850 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.255850 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.255850 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:32:22.262588 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:32:22.361106 [debug] [Thread-1 (]: SQL status: BEGIN in 0.104 seconds
[0m12:32:22.361106 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.361106 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:32:22.377947 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m12:32:22.385931 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.393933 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:32:22.393933 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:32:22.393933 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.401932 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:32:22.401932 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:32:22.426748 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:32:22.426748 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.428760 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:32:22.428760 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:32:22.428760 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:32:22.444397 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:22.444397 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:32:22.444397 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:32:22.444397 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:32:22.444397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B4349B1550>]}
[0m12:32:22.460027 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.29s]
[0m12:32:22.460027 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:32:22.460027 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:32:22.460027 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:32:22.467243 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:32:22.467243 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:32:22.483286 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:32:22.483286 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:32:22.584462 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:32:22.584462 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:32:22.584462 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:32:22.584462 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:32:22.644385 [debug] [Thread-3 (]: SQL status: BEGIN in 0.067 seconds
[0m12:32:22.660033 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:32:22.660033 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            lower(coalesce(review_text::text, '')),
                            -- Remove URLs and email addresses
                            'https?://[^\s]+|www\.[^\s]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}',
                            '',
                            'g'
                        ),
                        -- Remove numbers and special characters, keep only letters and spaces
                        '[^a-zA-ZÀ-ÿ\u0600-\u06FF\s]',
                        ' ',
                        'g'
                    ),
                    -- Normalize multiple spaces
                    '\s+',
                    ' ',
                    'g'
                ),
                -- Remove English stop words
                '\m(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from|this|that|these|those|a|an|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|may|might|must|shall|can|dont|doesnt|wont|cant|isnt|arent|wasnt|werent)\M',
                ' ',
                'gi'
            ),
            -- Remove very short words (1-2 characters)
            '\m[a-zA-Z]{1,2}\M',
            ' ',
            'g'
        )
    ) as cleaned_text
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:32:22.660033 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  erreur de syntaxe sur ou près de « as »
LINE 73:  as cleaned_text,
          ^

[0m12:32:22.660033 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:32:22.660033 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:32:22.675657 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « as »
  LINE 73:  as cleaned_text,
            ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:32:22.675657 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d2f35b1-826e-4fa3-a08f-ecca44c66405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B43919BE60>]}
[0m12:32:22.675657 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.22s]
[0m12:32:22.675657 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:32:22.675657 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « as »
  LINE 73:  as cleaned_text,
            ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:32:22.675657 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:22.675657 [debug] [MainThread]: On master: BEGIN
[0m12:32:22.675657 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:32:22.769255 [debug] [MainThread]: SQL status: BEGIN in 0.085 seconds
[0m12:32:22.769255 [debug] [MainThread]: On master: COMMIT
[0m12:32:22.769255 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:22.769255 [debug] [MainThread]: On master: COMMIT
[0m12:32:22.769255 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:32:22.769255 [debug] [MainThread]: On master: Close
[0m12:32:22.769255 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:32:22.769255 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:32:22.769255 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:32:22.777256 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:32:22.778075 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:32:22.778075 [info ] [MainThread]: 
[0m12:32:22.778075 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.19 seconds (1.19s).
[0m12:32:22.778075 [debug] [MainThread]: Command end result
[0m12:32:22.851833 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:32:22.851833 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:32:22.869034 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:32:22.869034 [info ] [MainThread]: 
[0m12:32:22.869034 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:32:22.875324 [info ] [MainThread]: 
[0m12:32:22.877749 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « as »
  LINE 73:  as cleaned_text,
            ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:32:22.877749 [info ] [MainThread]: 
[0m12:32:22.877749 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:32:22.885744 [debug] [MainThread]: Command `dbt run` failed at 12:32:22.877749 after 3.69 seconds
[0m12:32:22.885744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B437498AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B43683D2B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B43683D820>]}
[0m12:32:22.885744 [debug] [MainThread]: Flushing usage events
[0m12:32:26.332269 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:32:57.942810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB85C11250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB88614920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8806E900>]}


============================== 12:32:57.942810 | 4cd9c97b-9f9e-4e5a-a789-d26c713b7029 ==============================
[0m12:32:57.942810 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:32:57.942810 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:32:58.210340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB88CC3830>]}
[0m12:32:58.294976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB88ADDA90>]}
[0m12:32:58.294976 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:32:58.672083 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:32:59.004260 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:32:59.004260 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:32:59.320756 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:32:59.354064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A676750>]}
[0m12:32:59.474106 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:32:59.474106 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:32:59.505377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A3786E0>]}
[0m12:32:59.505377 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:32:59.505377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A70DA60>]}
[0m12:32:59.521002 [info ] [MainThread]: 
[0m12:32:59.521002 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:32:59.521002 [info ] [MainThread]: 
[0m12:32:59.525185 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:32:59.532088 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:32:59.646373 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:32:59.646373 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:32:59.646373 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:32:59.721977 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.083 seconds
[0m12:32:59.737600 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:32:59.737600 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:32:59.737600 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:32:59.737600 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:32:59.737600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:32:59.820763 [debug] [ThreadPool]: SQL status: BEGIN in 0.069 seconds
[0m12:32:59.820763 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:32:59.820763 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:32:59.820763 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.008 seconds
[0m12:32:59.820763 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:32:59.820763 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:32:59.858529 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:59.858529 [debug] [MainThread]: On master: BEGIN
[0m12:32:59.858529 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:32:59.921065 [debug] [MainThread]: SQL status: BEGIN in 0.070 seconds
[0m12:32:59.921065 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:59.921065 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:32:59.936670 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:32:59.936670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A0CA300>]}
[0m12:32:59.936670 [debug] [MainThread]: On master: ROLLBACK
[0m12:32:59.936670 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:59.936670 [debug] [MainThread]: On master: BEGIN
[0m12:32:59.936670 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:32:59.952294 [debug] [MainThread]: On master: COMMIT
[0m12:32:59.952294 [debug] [MainThread]: Using postgres connection "master"
[0m12:32:59.952294 [debug] [MainThread]: On master: COMMIT
[0m12:32:59.952294 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:32:59.952294 [debug] [MainThread]: On master: Close
[0m12:32:59.958808 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:32:59.958808 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:32:59.958808 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:32:59.958808 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:32:59.975642 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:32:59.977143 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:33:00.039306 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.039306 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.047350 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:33:00.047350 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:33:00.105748 [debug] [Thread-1 (]: SQL status: BEGIN in 0.068 seconds
[0m12:33:00.105748 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.105748 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:33:00.121374 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m12:33:00.137002 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.137002 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:33:00.137002 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:33:00.137002 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.137002 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:33:00.137002 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:33:00.174773 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:33:00.174773 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.174773 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:33:00.174773 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:33:00.192249 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:33:00.192249 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:33:00.206436 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:33:00.208703 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:33:00.208703 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:33:00.208703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB85D11430>]}
[0m12:33:00.216719 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.25s]
[0m12:33:00.216719 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:33:00.216719 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:33:00.216719 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:33:00.222968 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:33:00.222968 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:33:00.222968 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:33:00.222968 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:33:00.331328 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:33:00.339329 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:33:00.339329 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:33:00.339329 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:33:00.406289 [debug] [Thread-3 (]: SQL status: BEGIN in 0.069 seconds
[0m12:33:00.406289 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:33:00.406289 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace, and remove stop words
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(
                            lower(review_text),
                            '[^a-z0-9\s\']',  -- Keep apostrophes for contractions
                            '',
                            'g'
                        ),
                        '\s+',
                        ' ',
                        'g'
                    ),
                    -- Handle common contractions
                    'doesn\'t', 'does not',
                    'g'
                ),
                -- Remove only the most common stop words that don't add meaning
                '(\s|^)(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from)(\s|$)',
                ' ',
                'g'
            ),
            '\s+',
            ' ',
            'g'
        )
    ) as cleaned_text
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:33:00.406289 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  erreur de syntaxe sur ou près de « ] »
LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                  ^

[0m12:33:00.406289 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:33:00.406289 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:33:00.421918 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « ] »
  LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                    ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:33:00.421918 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cd9c97b-9f9e-4e5a-a789-d26c713b7029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8AA23E90>]}
[0m12:33:00.421918 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.20s]
[0m12:33:00.421918 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:33:00.421918 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « ] »
  LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                    ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:33:00.421918 [debug] [MainThread]: Using postgres connection "master"
[0m12:33:00.421918 [debug] [MainThread]: On master: BEGIN
[0m12:33:00.421918 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:33:00.506786 [debug] [MainThread]: SQL status: BEGIN in 0.071 seconds
[0m12:33:00.506786 [debug] [MainThread]: On master: COMMIT
[0m12:33:00.506786 [debug] [MainThread]: Using postgres connection "master"
[0m12:33:00.506786 [debug] [MainThread]: On master: COMMIT
[0m12:33:00.506786 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:33:00.506786 [debug] [MainThread]: On master: Close
[0m12:33:00.506786 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:33:00.506786 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:33:00.506786 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:33:00.506786 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:33:00.514791 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:33:00.514791 [info ] [MainThread]: 
[0m12:33:00.514791 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 0.99 seconds (0.99s).
[0m12:33:00.514791 [debug] [MainThread]: Command end result
[0m12:33:00.576318 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:33:00.576318 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:33:00.591952 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:33:00.591952 [info ] [MainThread]: 
[0m12:33:00.591952 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:33:00.591952 [info ] [MainThread]: 
[0m12:33:00.591952 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « ] »
  LINE 48:                             '[^a-z0-9\s\']',  -- Keep apostr...
                                                    ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:33:00.591952 [info ] [MainThread]: 
[0m12:33:00.591952 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:33:00.606254 [debug] [MainThread]: Command `dbt run` failed at 12:33:00.606254 after 2.80 seconds
[0m12:33:00.606254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A70EF60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A676240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EB8A676000>]}
[0m12:33:00.606254 [debug] [MainThread]: Flushing usage events
[0m12:33:01.643805 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:33:59.350476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DF435A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DF5F92B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DF495C70>]}


============================== 12:33:59.366086 | 1a6e36d3-e9c6-457d-b022-6e705e57b312 ==============================
[0m12:33:59.366086 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:33:59.366086 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:33:59.613105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DEE27C80>]}
[0m12:33:59.698071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DF921AF0>]}
[0m12:33:59.698071 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:34:00.093882 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:34:00.420803 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:34:00.420803 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:34:00.759257 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:34:00.783514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267E131E5A0>]}
[0m12:34:00.897039 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:34:00.897039 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:34:00.943905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267E1009400>]}
[0m12:34:00.943905 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:34:00.943905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267E1321880>]}
[0m12:34:00.943905 [info ] [MainThread]: 
[0m12:34:00.943905 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:34:00.943905 [info ] [MainThread]: 
[0m12:34:00.943905 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:34:00.963720 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:34:01.069740 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:34:01.069740 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:34:01.069740 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:34:01.145364 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.078 seconds
[0m12:34:01.145364 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:34:01.145364 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:34:01.166504 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:34:01.166504 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:34:01.166504 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:34:01.229036 [debug] [ThreadPool]: SQL status: BEGIN in 0.065 seconds
[0m12:34:01.229036 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:34:01.229036 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:34:01.244660 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.009 seconds
[0m12:34:01.244660 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:34:01.244660 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:34:01.266780 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:01.266780 [debug] [MainThread]: On master: BEGIN
[0m12:34:01.266780 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:34:01.329291 [debug] [MainThread]: SQL status: BEGIN in 0.067 seconds
[0m12:34:01.329291 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:01.329291 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:34:01.344915 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:34:01.344915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DCA9BDA0>]}
[0m12:34:01.344915 [debug] [MainThread]: On master: ROLLBACK
[0m12:34:01.344915 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:01.360541 [debug] [MainThread]: On master: BEGIN
[0m12:34:01.360541 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:34:01.360541 [debug] [MainThread]: On master: COMMIT
[0m12:34:01.360541 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:01.360541 [debug] [MainThread]: On master: COMMIT
[0m12:34:01.360541 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:34:01.360541 [debug] [MainThread]: On master: Close
[0m12:34:01.367054 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:01.367054 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:34:01.367054 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:34:01.367054 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:01.387071 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.387071 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:01.440084 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.440084 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.440084 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:34:01.440084 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:34:01.498418 [debug] [Thread-1 (]: SQL status: BEGIN in 0.068 seconds
[0m12:34:01.498418 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.498418 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:34:01.514043 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m12:34:01.529672 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.529672 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:34:01.529672 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:01.529672 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.529672 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:34:01.529672 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:01.560940 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:34:01.560940 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.560940 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:34:01.567517 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m12:34:01.567517 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:34:01.583160 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:01.583160 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:34:01.586263 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:34:01.586263 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:34:01.586263 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267E1B22BA0>]}
[0m12:34:01.586263 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m12:34:01.586263 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:01.598515 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:01.598515 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:34:01.598515 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:34:01.602333 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:01.610191 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:01.615294 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:01.714814 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:01.714814 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:01.714814 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:34:01.714814 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:34:01.798969 [debug] [Thread-3 (]: SQL status: BEGIN in 0.086 seconds
[0m12:34:01.798969 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:01.798969 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace, and remove stop words
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        lower(coalesce(review_text, '')),
                        '[^a-z0-9\s]',  -- Remove special characters
                        '',
                        'g'
                    ),
                    '\s+',
                    ' ',
                    'g'
                ),
                -- Handle common contractions
                'doesnt', 'does not',
                'g'
            ),
            -- Remove only the most common stop words that don't add meaning
            '(\s|^)(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from)(\s|$)',
            ' ',
            'g'
        )
    ) as cleaned_text
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:34:01.814588 [debug] [Thread-3 (]: Postgres adapter: Postgres error: ERREUR:  erreur de syntaxe sur ou près de « as »
LINE 65:  as cleaned_text,
          ^

[0m12:34:01.814588 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: ROLLBACK
[0m12:34:01.814588 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:34:01.814588 [debug] [Thread-3 (]: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « as »
  LINE 65:  as cleaned_text,
            ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:34:01.814588 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a6e36d3-e9c6-457d-b022-6e705e57b312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267E1B3A210>]}
[0m12:34:01.814588 [error] [Thread-3 (]: 2 of 2 ERROR creating sql table model public.int_bank_reviews .................. [[31mERROR[0m in 0.22s]
[0m12:34:01.814588 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:01.814588 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.int_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « as »
  LINE 65:  as cleaned_text,
            ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql.
[0m12:34:01.830213 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:01.830213 [debug] [MainThread]: On master: BEGIN
[0m12:34:01.830213 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:34:01.898393 [debug] [MainThread]: SQL status: BEGIN in 0.073 seconds
[0m12:34:01.906393 [debug] [MainThread]: On master: COMMIT
[0m12:34:01.906393 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:01.906393 [debug] [MainThread]: On master: COMMIT
[0m12:34:01.906393 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:34:01.906393 [debug] [MainThread]: On master: Close
[0m12:34:01.906393 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:34:01.906393 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:34:01.906393 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:34:01.906393 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:34:01.906393 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:34:01.906393 [info ] [MainThread]: 
[0m12:34:01.915583 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m12:34:01.915583 [debug] [MainThread]: Command end result
[0m12:34:01.972174 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:34:01.983991 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:34:01.983991 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:34:01.983991 [info ] [MainThread]: 
[0m12:34:01.983991 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:34:01.983991 [info ] [MainThread]: 
[0m12:34:01.998632 [error] [MainThread]:   Database Error in model int_bank_reviews (models\intermediate\int_bank_reviews.sql)
  ERREUR:  erreur de syntaxe sur ou près de « as »
  LINE 65:  as cleaned_text,
            ^
  compiled code at target\run\bank_reviews_analysis\models\intermediate\int_bank_reviews.sql
[0m12:34:01.998632 [info ] [MainThread]: 
[0m12:34:01.998632 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:34:01.998632 [debug] [MainThread]: Command `dbt run` failed at 12:34:01.998632 after 2.78 seconds
[0m12:34:02.005859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DF726C60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DF10E870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267DE96C110>]}
[0m12:34:02.005859 [debug] [MainThread]: Flushing usage events
[0m12:34:03.932292 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:34:44.150345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1384AC0E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1384ADC40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1384AE510>]}


============================== 12:34:44.150345 | d69b8abb-9140-4de2-931f-083ca2152f47 ==============================
[0m12:34:44.150345 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:34:44.150345 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:34:44.413022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1385F0E60>]}
[0m12:34:44.497708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D138686EA0>]}
[0m12:34:44.497708 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:34:44.882698 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:34:45.219946 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:34:45.219946 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:34:45.543042 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:34:45.579432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D139F62210>]}
[0m12:34:45.690697 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:34:45.690697 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:34:45.733980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D139C3DF40>]}
[0m12:34:45.733980 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:34:45.733980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D139CD1250>]}
[0m12:34:45.733980 [info ] [MainThread]: 
[0m12:34:45.733980 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:34:45.749620 [info ] [MainThread]: 
[0m12:34:45.751476 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:34:45.759654 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:34:46.042592 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:34:46.042592 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:34:46.042592 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:34:46.181166 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.132 seconds
[0m12:34:46.181166 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:34:46.181166 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:34:46.200921 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:34:46.200921 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:34:46.200921 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:34:46.280990 [debug] [ThreadPool]: SQL status: BEGIN in 0.077 seconds
[0m12:34:46.280990 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:34:46.280990 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:34:46.280990 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.008 seconds
[0m12:34:46.280990 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:34:46.280990 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:34:46.312241 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:46.312241 [debug] [MainThread]: On master: BEGIN
[0m12:34:46.312241 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:34:46.365629 [debug] [MainThread]: SQL status: BEGIN in 0.064 seconds
[0m12:34:46.365629 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:46.365629 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:34:46.381268 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:34:46.381268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D13578BE60>]}
[0m12:34:46.381268 [debug] [MainThread]: On master: ROLLBACK
[0m12:34:46.396891 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:46.396891 [debug] [MainThread]: On master: BEGIN
[0m12:34:46.396891 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:34:46.396891 [debug] [MainThread]: On master: COMMIT
[0m12:34:46.396891 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:46.396891 [debug] [MainThread]: On master: COMMIT
[0m12:34:46.396891 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:34:46.396891 [debug] [MainThread]: On master: Close
[0m12:34:46.396891 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:46.396891 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:34:46.396891 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:34:46.412536 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:46.412536 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.412536 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:46.476352 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.476352 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.476352 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:34:46.476352 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:34:46.547294 [debug] [Thread-1 (]: SQL status: BEGIN in 0.071 seconds
[0m12:34:46.547294 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.547294 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:34:46.562925 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m12:34:46.565947 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.565947 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:34:46.565947 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:46.565947 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.581591 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:34:46.581591 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:46.612848 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:34:46.612848 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.612848 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:34:46.612848 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m12:34:46.628484 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:34:46.644119 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:34:46.644119 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:34:46.659730 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:34:46.659730 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:34:46.666244 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1356E1490>]}
[0m12:34:46.666244 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.27s]
[0m12:34:46.666244 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:34:46.666244 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:46.666244 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:34:46.677233 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:34:46.677233 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:46.685025 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:46.685025 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:46.782528 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:46.798183 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:46.798183 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:34:46.798183 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:34:46.866671 [debug] [Thread-3 (]: SQL status: BEGIN in 0.070 seconds
[0m12:34:46.866671 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:46.866671 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace, and remove stop words
    trim(
        regexp_replace(
            regexp_replace(
                regexp_replace(
                    regexp_replace(
                        lower(coalesce(review_text, '')),
                        '[^a-z0-9\s]',  -- Remove special characters
                        '',
                        'g'
                    ),
                    '\s+',
                    ' ',
                    'g'
                ),
                -- Handle common contractions
                'doesnt', 'does not',
                'g'
            ),
            -- Remove only the most common stop words that don't add meaning
            '(\s|^)(the|and|or|but|in|on|at|to|for|with|by|about|as|of|from)(\s|$)',
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:34:47.082876 [debug] [Thread-3 (]: SQL status: SELECT 4374 in 0.220 seconds
[0m12:34:47.098486 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:47.098486 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews" rename to "int_bank_reviews__dbt_backup"
[0m12:34:47.098486 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:47.098486 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:47.098486 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m12:34:47.114106 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:47.114106 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:34:47.114106 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:47.114106 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:34:47.114106 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m12:34:47.114106 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m12:34:47.114106 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:34:47.114106 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m12:34:47.129753 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m12:34:47.129753 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:34:47.129753 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd69b8abb-9140-4de2-931f-083ca2152f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D13A311730>]}
[0m12:34:47.129753 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public.int_bank_reviews ...................... [[32mSELECT 4374[0m in 0.46s]
[0m12:34:47.129753 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:34:47.145361 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:47.145361 [debug] [MainThread]: On master: BEGIN
[0m12:34:47.145361 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:34:47.217933 [debug] [MainThread]: SQL status: BEGIN in 0.076 seconds
[0m12:34:47.217933 [debug] [MainThread]: On master: COMMIT
[0m12:34:47.217933 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:47.225936 [debug] [MainThread]: On master: COMMIT
[0m12:34:47.227075 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:34:47.227075 [debug] [MainThread]: On master: Close
[0m12:34:47.227075 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:34:47.227075 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:34:47.227075 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:34:47.227075 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:34:47.227075 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:34:47.227075 [info ] [MainThread]: 
[0m12:34:47.227075 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m12:34:47.227075 [debug] [MainThread]: Command end result
[0m12:34:47.294931 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:34:47.294931 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:34:47.309508 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:34:47.309508 [info ] [MainThread]: 
[0m12:34:47.309508 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:34:47.309508 [info ] [MainThread]: 
[0m12:34:47.309508 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m12:34:47.309508 [debug] [MainThread]: Command `dbt run` succeeded at 12:34:47.309508 after 3.31 seconds
[0m12:34:47.309508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D139F5E540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D13A7D7BC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D137F0F830>]}
[0m12:34:47.317510 [debug] [MainThread]: Flushing usage events
[0m12:34:52.409176 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:46:53.686441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E91471700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E9417BA70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E93396330>]}


============================== 12:46:53.702083 | 257f755a-5060-442a-a267-88f03754b391 ==============================
[0m12:46:53.702083 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:46:53.702083 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:46:53.986389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E94436FC0>]}
[0m12:46:54.071048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E94577AD0>]}
[0m12:46:54.071048 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:46:54.471605 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:46:54.803762 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:46:54.819387 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m12:46:55.143428 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.bank_reviews_analysis.marts
[0m12:46:55.166783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E958B4890>]}
[0m12:46:55.281221 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:46:55.281221 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:46:55.328096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E95A736E0>]}
[0m12:46:55.343732 [info ] [MainThread]: Found 2 models, 1 source, 846 macros
[0m12:46:55.343732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E95E0DFD0>]}
[0m12:46:55.343732 [info ] [MainThread]: 
[0m12:46:55.343732 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:46:55.360550 [info ] [MainThread]: 
[0m12:46:55.360550 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:46:55.367919 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:46:55.565797 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:46:55.581432 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:46:55.581432 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:46:55.643931 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.073 seconds
[0m12:46:55.643931 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:46:55.659560 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:46:55.666095 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:46:55.666095 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:46:55.666095 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:46:55.728611 [debug] [ThreadPool]: SQL status: BEGIN in 0.067 seconds
[0m12:46:55.728611 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:46:55.728611 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:46:55.744256 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.008 seconds
[0m12:46:55.744256 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:46:55.744256 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:46:55.766412 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:55.766412 [debug] [MainThread]: On master: BEGIN
[0m12:46:55.766412 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:46:55.844554 [debug] [MainThread]: SQL status: BEGIN in 0.067 seconds
[0m12:46:55.844554 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:55.844554 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:46:55.844554 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m12:46:55.860178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E961F21B0>]}
[0m12:46:55.860178 [debug] [MainThread]: On master: ROLLBACK
[0m12:46:55.860178 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:55.860178 [debug] [MainThread]: On master: BEGIN
[0m12:46:55.860178 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:46:55.866689 [debug] [MainThread]: On master: COMMIT
[0m12:46:55.866689 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:55.866689 [debug] [MainThread]: On master: COMMIT
[0m12:46:55.866689 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:46:55.866689 [debug] [MainThread]: On master: Close
[0m12:46:55.866689 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:46:55.866689 [info ] [Thread-1 (]: 1 of 2 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:46:55.866689 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:46:55.866689 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:46:55.888579 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:55.888579 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:46:55.940395 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:55.940395 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:55.948396 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:46:55.948396 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:46:56.014626 [debug] [Thread-1 (]: SQL status: BEGIN in 0.065 seconds
[0m12:46:56.014626 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:56.014626 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:46:56.022658 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m12:46:56.032230 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:56.040243 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:46:56.040243 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:46:56.040243 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:56.040243 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:46:56.048775 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:46:56.066959 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:46:56.066959 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:56.066959 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:46:56.066959 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m12:46:56.082618 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:46:56.082618 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:46:56.098247 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:46:56.098247 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:46:56.098247 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:46:56.098247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E915719A0>]}
[0m12:46:56.098247 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m12:46:56.098247 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:46:56.098247 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:46:56.113867 [info ] [Thread-3 (]: 2 of 2 START sql table model public.int_bank_reviews ........................... [RUN]
[0m12:46:56.113867 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:46:56.113867 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:46:56.133204 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.134315 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:46:56.223167 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.238819 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.238819 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:46:56.238819 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:46:56.313829 [debug] [Thread-3 (]: SQL status: BEGIN in 0.071 seconds
[0m12:46:56.313829 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.313829 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  
    

  create  table "DataWare"."public"."int_bank_reviews__dbt_tmp"
  
  
    as
  
  (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
  
[0m12:46:56.445368 [debug] [Thread-3 (]: SQL status: SELECT 4374 in 0.132 seconds
[0m12:46:56.445368 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.445368 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews" rename to "int_bank_reviews__dbt_backup"
[0m12:46:56.460994 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:46:56.460994 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.467506 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m12:46:56.467506 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:46:56.467506 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:46:56.467506 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.467506 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:46:56.467506 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m12:46:56.483168 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m12:46:56.483168 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:46:56.483168 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m12:46:56.483168 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m12:46:56.498771 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:46:56.498771 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '257f755a-5060-442a-a267-88f03754b391', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E95D0CFB0>]}
[0m12:46:56.498771 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public.int_bank_reviews ...................... [[32mSELECT 4374[0m in 0.38s]
[0m12:46:56.498771 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:46:56.498771 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.498771 [debug] [MainThread]: On master: BEGIN
[0m12:46:56.498771 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:46:56.575726 [debug] [MainThread]: SQL status: BEGIN in 0.073 seconds
[0m12:46:56.575726 [debug] [MainThread]: On master: COMMIT
[0m12:46:56.575726 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.575726 [debug] [MainThread]: On master: COMMIT
[0m12:46:56.583788 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:46:56.583788 [debug] [MainThread]: On master: Close
[0m12:46:56.583788 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:46:56.583788 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:46:56.583788 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:46:56.583788 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:46:56.583788 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:46:56.583788 [info ] [MainThread]: 
[0m12:46:56.583788 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 1.22 seconds (1.22s).
[0m12:46:56.583788 [debug] [MainThread]: Command end result
[0m12:46:56.648696 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:46:56.656698 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:46:56.664695 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:46:56.665682 [info ] [MainThread]: 
[0m12:46:56.667691 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:46:56.667691 [info ] [MainThread]: 
[0m12:46:56.667691 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m12:46:56.667691 [debug] [MainThread]: Command `dbt run` succeeded at 12:46:56.667691 after 3.14 seconds
[0m12:46:56.667691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E939615E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E93D1FA40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E93D1F260>]}
[0m12:46:56.667691 [debug] [MainThread]: Flushing usage events
[0m12:46:57.432225 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:55:34.172695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FF6E3E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FF6E3C80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FF6E37D0>]}


============================== 12:55:34.188352 | 37685506-9560-4615-9af2-2f4676ebf014 ==============================
[0m12:55:34.188352 [info ] [MainThread]: Running with dbt=1.9.6
[0m12:55:34.188352 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:55:34.457677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FF32F140>]}
[0m12:55:34.539558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FF7F7EF0>]}
[0m12:55:34.548148 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:55:34.947029 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m12:55:35.348062 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m12:55:35.348062 [debug] [MainThread]: Partial parsing: added file: bank_reviews_analysis://models\marts\mart_location_reviews.sql
[0m12:55:35.348062 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\intermediate\int_bank_reviews.sql
[0m12:55:35.703893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002808124A330>]}
[0m12:55:35.804216 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:55:35.804216 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:55:35.866715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FFE204D0>]}
[0m12:55:35.866715 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m12:55:35.866715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280812439E0>]}
[0m12:55:35.866715 [info ] [MainThread]: 
[0m12:55:35.866715 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:55:35.877564 [info ] [MainThread]: 
[0m12:55:35.877564 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:55:35.888479 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m12:55:36.004661 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m12:55:36.004661 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m12:55:36.004661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:55:36.104977 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.088 seconds
[0m12:55:36.104977 [debug] [ThreadPool]: On list_DataWare: Close
[0m12:55:36.104977 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m12:55:36.104977 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:55:36.104977 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m12:55:36.120602 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:55:36.189274 [debug] [ThreadPool]: SQL status: BEGIN in 0.073 seconds
[0m12:55:36.189274 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m12:55:36.189274 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:55:36.204934 [debug] [ThreadPool]: SQL status: SELECT 48 in 0.011 seconds
[0m12:55:36.204934 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m12:55:36.204934 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m12:55:36.220560 [debug] [MainThread]: Using postgres connection "master"
[0m12:55:36.220560 [debug] [MainThread]: On master: BEGIN
[0m12:55:36.220560 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:55:36.289574 [debug] [MainThread]: SQL status: BEGIN in 0.068 seconds
[0m12:55:36.289574 [debug] [MainThread]: Using postgres connection "master"
[0m12:55:36.289574 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:55:36.305233 [debug] [MainThread]: SQL status: SELECT 1 in 0.014 seconds
[0m12:55:36.305233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002808137BAD0>]}
[0m12:55:36.320836 [debug] [MainThread]: On master: ROLLBACK
[0m12:55:36.320836 [debug] [MainThread]: Using postgres connection "master"
[0m12:55:36.320836 [debug] [MainThread]: On master: BEGIN
[0m12:55:36.320836 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:55:36.320836 [debug] [MainThread]: On master: COMMIT
[0m12:55:36.320836 [debug] [MainThread]: Using postgres connection "master"
[0m12:55:36.320836 [debug] [MainThread]: On master: COMMIT
[0m12:55:36.320836 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:55:36.320836 [debug] [MainThread]: On master: Close
[0m12:55:36.320836 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:55:36.336482 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m12:55:36.336482 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m12:55:36.336482 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m12:55:36.336482 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.336482 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m12:55:36.406273 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.406273 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.406273 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m12:55:36.406273 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:55:36.469198 [debug] [Thread-1 (]: SQL status: BEGIN in 0.065 seconds
[0m12:55:36.469198 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.469198 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m12:55:36.497314 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.024 seconds
[0m12:55:36.512966 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.512966 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m12:55:36.512966 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m12:55:36.528602 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.528602 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m12:55:36.528602 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:55:36.575487 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:55:36.575487 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.575487 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m12:55:36.575487 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:55:36.597636 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m12:55:36.597636 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m12:55:36.597636 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m12:55:36.613295 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m12:55:36.613295 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m12:55:36.613295 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FC821220>]}
[0m12:55:36.613295 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.28s]
[0m12:55:36.613295 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m12:55:36.628901 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m12:55:36.628901 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m12:55:36.632202 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m12:55:36.632202 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m12:55:36.636387 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.644277 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m12:55:36.691248 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.691248 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.697919 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m12:55:36.701699 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:55:36.890847 [debug] [Thread-3 (]: SQL status: BEGIN in 0.190 seconds
[0m12:55:36.890847 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.890847 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m12:55:36.919096 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.020 seconds
[0m12:55:36.976015 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.976015 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews" rename to "int_bank_reviews__dbt_backup"
[0m12:55:36.976015 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:55:36.991632 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.991632 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m12:55:36.991632 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:55:36.991632 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:55:36.991632 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:36.991632 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m12:55:36.991632 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m12:55:37.007280 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m12:55:37.007280 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m12:55:37.007280 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop table if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m12:55:37.022881 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m12:55:37.022881 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m12:55:37.022881 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028081AFECF0>]}
[0m12:55:37.029396 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.39s]
[0m12:55:37.029396 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m12:55:37.029396 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m12:55:37.029396 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m12:55:37.029396 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m12:55:37.037581 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m12:55:37.048688 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.054261 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m12:55:37.098635 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.098635 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.098635 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m12:55:37.098635 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:55:37.171179 [debug] [Thread-2 (]: SQL status: BEGIN in 0.068 seconds
[0m12:55:37.171179 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.171179 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
        bank_name,
        branch_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by bank_name, branch_name, location
)

select 
    bank_name,
    branch_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by bank_name, branch_name, location
  );
  
[0m12:55:37.446962 [debug] [Thread-2 (]: SQL status: SELECT 820 in 0.282 seconds
[0m12:55:37.462566 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.462566 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
alter table "DataWare"."public"."mart_location_reviews__dbt_tmp" rename to "mart_location_reviews"
[0m12:55:37.462566 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:55:37.462566 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: COMMIT
[0m12:55:37.462566 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.462566 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: COMMIT
[0m12:55:37.462566 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m12:55:37.478194 [debug] [Thread-2 (]: Applying DROP to: "DataWare"."public"."mart_location_reviews__dbt_backup"
[0m12:55:37.478194 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m12:55:37.478194 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
drop table if exists "DataWare"."public"."mart_location_reviews__dbt_backup" cascade
[0m12:55:37.478194 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m12:55:37.478194 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m12:55:37.478194 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37685506-9560-4615-9af2-2f4676ebf014', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280816037D0>]}
[0m12:55:37.478194 [info ] [Thread-2 (]: 3 of 3 OK created sql table model public.mart_location_reviews ................. [[32mSELECT 820[0m in 0.45s]
[0m12:55:37.493817 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m12:55:37.493817 [debug] [MainThread]: Using postgres connection "master"
[0m12:55:37.493817 [debug] [MainThread]: On master: BEGIN
[0m12:55:37.493817 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:55:37.588882 [debug] [MainThread]: SQL status: BEGIN in 0.090 seconds
[0m12:55:37.588882 [debug] [MainThread]: On master: COMMIT
[0m12:55:37.588882 [debug] [MainThread]: Using postgres connection "master"
[0m12:55:37.588882 [debug] [MainThread]: On master: COMMIT
[0m12:55:37.588882 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:55:37.588882 [debug] [MainThread]: On master: Close
[0m12:55:37.588882 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:55:37.588882 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m12:55:37.588882 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m12:55:37.588882 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m12:55:37.588882 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m12:55:37.588882 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m12:55:37.588882 [info ] [MainThread]: 
[0m12:55:37.588882 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m12:55:37.604510 [debug] [MainThread]: Command end result
[0m12:55:37.650257 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m12:55:37.664475 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m12:55:37.666864 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m12:55:37.666864 [info ] [MainThread]: 
[0m12:55:37.666864 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:55:37.666864 [info ] [MainThread]: 
[0m12:55:37.666864 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m12:55:37.681391 [debug] [MainThread]: Command `dbt run` succeeded at 12:55:37.681391 after 3.65 seconds
[0m12:55:37.681391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280811B6C90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280815EF8C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280FEBD2780>]}
[0m12:55:37.681391 [debug] [MainThread]: Flushing usage events
[0m12:55:38.681755 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:02:16.355240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000187775F1430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877A0C7590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877A0C53A0>]}


============================== 13:02:16.364714 | 96b0ff8d-ff71-48cf-8a6a-5ec882af1612 ==============================
[0m13:02:16.364714 [info ] [MainThread]: Running with dbt=1.9.6
[0m13:02:16.367468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:02:16.655134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877B5F0FB0>]}
[0m13:02:16.737955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000187791B5820>]}
[0m13:02:16.748449 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:02:17.138614 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m13:02:17.504714 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:02:17.504714 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\marts\mart_location_reviews.sql
[0m13:02:17.897155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877C0DA450>]}
[0m13:02:18.021703 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:02:18.030444 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:02:18.071312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877BD4FBC0>]}
[0m13:02:18.071312 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m13:02:18.071312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877C0AA5D0>]}
[0m13:02:18.079796 [info ] [MainThread]: 
[0m13:02:18.079796 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:02:18.079796 [info ] [MainThread]: 
[0m13:02:18.087802 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:02:18.087802 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m13:02:18.220170 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m13:02:18.220170 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m13:02:18.220170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:02:18.304948 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.082 seconds
[0m13:02:18.304948 [debug] [ThreadPool]: On list_DataWare: Close
[0m13:02:18.313930 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m13:02:18.321934 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:02:18.321934 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m13:02:18.321934 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:02:18.405048 [debug] [ThreadPool]: SQL status: BEGIN in 0.083 seconds
[0m13:02:18.405048 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:02:18.405048 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:02:18.413658 [debug] [ThreadPool]: SQL status: SELECT 49 in 0.009 seconds
[0m13:02:18.421667 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m13:02:18.421667 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m13:02:18.438456 [debug] [MainThread]: Using postgres connection "master"
[0m13:02:18.438456 [debug] [MainThread]: On master: BEGIN
[0m13:02:18.446810 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:02:18.513580 [debug] [MainThread]: SQL status: BEGIN in 0.071 seconds
[0m13:02:18.513580 [debug] [MainThread]: Using postgres connection "master"
[0m13:02:18.513580 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:02:18.530276 [debug] [MainThread]: SQL status: SELECT 2 in 0.011 seconds
[0m13:02:18.530276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877C0DC0E0>]}
[0m13:02:18.530276 [debug] [MainThread]: On master: ROLLBACK
[0m13:02:18.530276 [debug] [MainThread]: Using postgres connection "master"
[0m13:02:18.530276 [debug] [MainThread]: On master: BEGIN
[0m13:02:18.530276 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:02:18.530276 [debug] [MainThread]: On master: COMMIT
[0m13:02:18.530276 [debug] [MainThread]: Using postgres connection "master"
[0m13:02:18.538278 [debug] [MainThread]: On master: COMMIT
[0m13:02:18.538278 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:02:18.538278 [debug] [MainThread]: On master: Close
[0m13:02:18.547038 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:02:18.547038 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m13:02:18.547038 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m13:02:18.547038 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m13:02:18.563091 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.563091 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m13:02:18.619102 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.619102 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.627100 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m13:02:18.627100 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:02:18.705049 [debug] [Thread-1 (]: SQL status: BEGIN in 0.079 seconds
[0m13:02:18.705049 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.705049 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m13:02:18.713670 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m13:02:18.730267 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.730267 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m13:02:18.730267 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:02:18.730267 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.738268 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m13:02:18.738268 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:02:18.763409 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:02:18.763409 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.763409 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:02:18.771415 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m13:02:18.788252 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m13:02:18.796650 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:02:18.796885 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m13:02:18.796885 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m13:02:18.796885 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m13:02:18.804888 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000187776E14C0>]}
[0m13:02:18.804888 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.26s]
[0m13:02:18.813387 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:02:18.813633 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m13:02:18.813633 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m13:02:18.813633 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m13:02:18.813633 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m13:02:18.821633 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:18.829634 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m13:02:18.837637 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:18.845636 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:18.845636 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m13:02:18.845636 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:02:18.925638 [debug] [Thread-3 (]: SQL status: BEGIN in 0.080 seconds
[0m13:02:18.930223 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:18.930223 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m13:02:18.938230 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m13:02:19.005132 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:19.005132 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m13:02:19.013052 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:02:19.013575 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:02:19.013575 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:19.013575 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:02:19.013575 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m13:02:19.021600 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m13:02:19.021600 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:02:19.021600 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop view if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m13:02:19.021600 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:02:19.021600 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m13:02:19.029518 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877C835FA0>]}
[0m13:02:19.030292 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.21s]
[0m13:02:19.030292 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m13:02:19.030292 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m13:02:19.030292 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m13:02:19.038298 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m13:02:19.038298 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m13:02:19.046296 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:02:19.046296 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m13:02:19.086309 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:02:19.094297 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:02:19.094297 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m13:02:19.094297 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:02:19.163633 [debug] [Thread-2 (]: SQL status: BEGIN in 0.071 seconds
[0m13:02:19.171637 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:02:19.171637 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
        bank_name,
        branch_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by location
)

select 
    bank_name,
    branch_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by bank_name, branch_name, location
  );
  
[0m13:02:19.180144 [debug] [Thread-2 (]: Postgres adapter: Postgres error: ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
LINE 16:         bank_name,
                 ^

[0m13:02:19.180144 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: ROLLBACK
[0m13:02:19.180144 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m13:02:19.196974 [debug] [Thread-2 (]: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 16:         bank_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:02:19.196974 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96b0ff8d-ff71-48cf-8a6a-5ec882af1612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877A5E1A00>]}
[0m13:02:19.196974 [error] [Thread-2 (]: 3 of 3 ERROR creating sql table model public.mart_location_reviews ............. [[31mERROR[0m in 0.17s]
[0m13:02:19.196974 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m13:02:19.196974 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.mart_location_reviews' to be skipped because of status 'error'.  Reason: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 16:         bank_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql.
[0m13:02:19.204977 [debug] [MainThread]: Using postgres connection "master"
[0m13:02:19.204977 [debug] [MainThread]: On master: BEGIN
[0m13:02:19.204977 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:02:19.285698 [debug] [MainThread]: SQL status: BEGIN in 0.083 seconds
[0m13:02:19.285698 [debug] [MainThread]: On master: COMMIT
[0m13:02:19.285698 [debug] [MainThread]: Using postgres connection "master"
[0m13:02:19.285698 [debug] [MainThread]: On master: COMMIT
[0m13:02:19.285698 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:02:19.285698 [debug] [MainThread]: On master: Close
[0m13:02:19.293705 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:02:19.293705 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m13:02:19.293705 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m13:02:19.297081 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m13:02:19.297234 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m13:02:19.297234 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m13:02:19.297234 [info ] [MainThread]: 
[0m13:02:19.297234 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.21 seconds (1.21s).
[0m13:02:19.297234 [debug] [MainThread]: Command end result
[0m13:02:19.361237 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:02:19.369241 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:02:19.377237 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m13:02:19.377237 [info ] [MainThread]: 
[0m13:02:19.377237 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:02:19.377237 [info ] [MainThread]: 
[0m13:02:19.385240 [error] [MainThread]:   Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 16:         bank_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:02:19.385240 [info ] [MainThread]: 
[0m13:02:19.385240 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:02:19.385240 [debug] [MainThread]: Command `dbt run` failed at 13:02:19.385240 after 3.19 seconds
[0m13:02:19.393238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877A032870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877C0AAE10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001877C0AAC90>]}
[0m13:02:19.393238 [debug] [MainThread]: Flushing usage events
[0m13:02:22.336603 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:05:45.600965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB7944FB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBA648170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBA80CA40>]}


============================== 13:05:45.614473 | db9ab36a-1894-4837-895a-b913dd7fc97e ==============================
[0m13:05:45.614473 [info ] [MainThread]: Running with dbt=1.9.6
[0m13:05:45.614473 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:05:45.877220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBAA440B0>]}
[0m13:05:45.961885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB9DD05F0>]}
[0m13:05:45.961885 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:05:46.366535 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m13:05:46.783347 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:05:46.783347 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\marts\mart_location_reviews.sql
[0m13:05:47.185133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBC13B440>]}
[0m13:05:47.284454 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:05:47.300075 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:05:47.337888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBC03F9E0>]}
[0m13:05:47.337888 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m13:05:47.337888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBC3B7620>]}
[0m13:05:47.353518 [info ] [MainThread]: 
[0m13:05:47.353518 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:05:47.359099 [info ] [MainThread]: 
[0m13:05:47.359099 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:05:47.368051 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m13:05:47.491665 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m13:05:47.491665 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m13:05:47.491665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:05:47.584824 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.095 seconds
[0m13:05:47.584824 [debug] [ThreadPool]: On list_DataWare: Close
[0m13:05:47.584824 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m13:05:47.600450 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:05:47.600450 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m13:05:47.600450 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:05:47.670439 [debug] [ThreadPool]: SQL status: BEGIN in 0.073 seconds
[0m13:05:47.670439 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:05:47.686353 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:05:47.694374 [debug] [ThreadPool]: SQL status: SELECT 49 in 0.012 seconds
[0m13:05:47.694374 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m13:05:47.702774 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m13:05:47.722452 [debug] [MainThread]: Using postgres connection "master"
[0m13:05:47.722452 [debug] [MainThread]: On master: BEGIN
[0m13:05:47.722452 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:05:47.784967 [debug] [MainThread]: SQL status: BEGIN in 0.070 seconds
[0m13:05:47.784967 [debug] [MainThread]: Using postgres connection "master"
[0m13:05:47.784967 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:05:47.800588 [debug] [MainThread]: SQL status: SELECT 2 in 0.013 seconds
[0m13:05:47.800588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB7AEBEC0>]}
[0m13:05:47.800588 [debug] [MainThread]: On master: ROLLBACK
[0m13:05:47.816217 [debug] [MainThread]: Using postgres connection "master"
[0m13:05:47.816217 [debug] [MainThread]: On master: BEGIN
[0m13:05:47.816217 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:05:47.816217 [debug] [MainThread]: On master: COMMIT
[0m13:05:47.816217 [debug] [MainThread]: Using postgres connection "master"
[0m13:05:47.816217 [debug] [MainThread]: On master: COMMIT
[0m13:05:47.816217 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:05:47.816217 [debug] [MainThread]: On master: Close
[0m13:05:47.822727 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:05:47.822727 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m13:05:47.822727 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m13:05:47.822727 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m13:05:47.840471 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:47.844716 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m13:05:47.894489 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:47.902489 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:47.902489 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m13:05:47.902489 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:05:48.100616 [debug] [Thread-1 (]: SQL status: BEGIN in 0.208 seconds
[0m13:05:48.100616 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:48.100616 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m13:05:48.138378 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.023 seconds
[0m13:05:48.138378 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:48.138378 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m13:05:48.138378 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m13:05:48.154004 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:48.154004 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m13:05:48.154004 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:05:48.169629 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:05:48.169629 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:48.169629 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:05:48.169629 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:05:48.185255 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m13:05:48.185255 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:05:48.185255 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m13:05:48.202914 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m13:05:48.202914 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m13:05:48.210915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB7A41340>]}
[0m13:05:48.210915 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.38s]
[0m13:05:48.210915 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:05:48.218914 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m13:05:48.219345 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m13:05:48.222280 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m13:05:48.222787 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m13:05:48.222787 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.230852 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m13:05:48.237975 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.237975 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.237975 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m13:05:48.237975 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:05:48.330656 [debug] [Thread-3 (]: SQL status: BEGIN in 0.083 seconds
[0m13:05:48.330656 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.330656 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m13:05:48.338703 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m13:05:48.416840 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.416840 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m13:05:48.416840 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m13:05:48.416840 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:05:48.422853 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.422853 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:05:48.422853 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m13:05:48.422853 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m13:05:48.422853 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:05:48.422853 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop view if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m13:05:48.422853 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m13:05:48.422853 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m13:05:48.422853 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBCB9B4A0>]}
[0m13:05:48.422853 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.20s]
[0m13:05:48.438495 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m13:05:48.438495 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m13:05:48.438495 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m13:05:48.446351 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m13:05:48.446351 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m13:05:48.456582 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:05:48.460366 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m13:05:48.503554 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:05:48.503554 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:05:48.503554 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m13:05:48.503554 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:05:48.576035 [debug] [Thread-2 (]: SQL status: BEGIN in 0.070 seconds
[0m13:05:48.576035 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:05:48.576035 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
        bank_name,
        branch_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by location
)

select 
    bank_name,
    branch_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by location
  );
  
[0m13:05:48.591661 [debug] [Thread-2 (]: Postgres adapter: Postgres error: ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
LINE 16:         bank_name,
                 ^

[0m13:05:48.591661 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: ROLLBACK
[0m13:05:48.591661 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m13:05:48.607286 [debug] [Thread-2 (]: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 16:         bank_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:05:48.607286 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9ab36a-1894-4837-895a-b913dd7fc97e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBBFD7FB0>]}
[0m13:05:48.607286 [error] [Thread-2 (]: 3 of 3 ERROR creating sql table model public.mart_location_reviews ............. [[31mERROR[0m in 0.17s]
[0m13:05:48.607286 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m13:05:48.607286 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.mart_location_reviews' to be skipped because of status 'error'.  Reason: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 16:         bank_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql.
[0m13:05:48.607286 [debug] [MainThread]: Using postgres connection "master"
[0m13:05:48.607286 [debug] [MainThread]: On master: BEGIN
[0m13:05:48.607286 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:05:48.685628 [debug] [MainThread]: SQL status: BEGIN in 0.077 seconds
[0m13:05:48.693690 [debug] [MainThread]: On master: COMMIT
[0m13:05:48.693690 [debug] [MainThread]: Using postgres connection "master"
[0m13:05:48.693690 [debug] [MainThread]: On master: COMMIT
[0m13:05:48.693690 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:05:48.693690 [debug] [MainThread]: On master: Close
[0m13:05:48.693690 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:05:48.693690 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m13:05:48.693690 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m13:05:48.693690 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m13:05:48.693690 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m13:05:48.693690 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m13:05:48.693690 [info ] [MainThread]: 
[0m13:05:48.693690 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.33 seconds (1.33s).
[0m13:05:48.693690 [debug] [MainThread]: Command end result
[0m13:05:48.764195 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:05:48.769309 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:05:48.771655 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m13:05:48.771655 [info ] [MainThread]: 
[0m13:05:48.771655 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:05:48.771655 [info ] [MainThread]: 
[0m13:05:48.785952 [error] [MainThread]:   Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.bank_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 16:         bank_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:05:48.785952 [info ] [MainThread]: 
[0m13:05:48.785952 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:05:48.792136 [debug] [MainThread]: Command `dbt run` failed at 13:05:48.792136 after 3.34 seconds
[0m13:05:48.792136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB7944FB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBA4BF8F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADBA4BF4D0>]}
[0m13:05:48.792136 [debug] [MainThread]: Flushing usage events
[0m13:05:49.771970 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:07:23.397512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A02C2F9B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A034A8110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A7FD40EC0>]}


============================== 13:07:23.413156 | c927edf8-8204-4c54-84c9-02a873e4081e ==============================
[0m13:07:23.413156 [info ] [MainThread]: Running with dbt=1.9.6
[0m13:07:23.413156 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:07:23.666169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A00922540>]}
[0m13:07:23.738948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A00C07C80>]}
[0m13:07:23.747002 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:07:24.135382 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m13:07:24.505296 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:07:24.505296 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\marts\mart_location_reviews.sql
[0m13:07:24.859593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A052B5F70>]}
[0m13:07:24.968013 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:07:24.968013 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:07:25.014910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A04F07020>]}
[0m13:07:25.014910 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m13:07:25.014910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A04CD7050>]}
[0m13:07:25.014910 [info ] [MainThread]: 
[0m13:07:25.014910 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:07:25.014910 [info ] [MainThread]: 
[0m13:07:25.027015 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:07:25.038610 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m13:07:25.160421 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m13:07:25.160421 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m13:07:25.160421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:07:25.260694 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.099 seconds
[0m13:07:25.260694 [debug] [ThreadPool]: On list_DataWare: Close
[0m13:07:25.276336 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m13:07:25.276336 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:07:25.291958 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m13:07:25.291958 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:07:25.360970 [debug] [ThreadPool]: SQL status: BEGIN in 0.077 seconds
[0m13:07:25.360970 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:07:25.360970 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:07:25.376609 [debug] [ThreadPool]: SQL status: SELECT 49 in 0.009 seconds
[0m13:07:25.376609 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m13:07:25.376609 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m13:07:25.392236 [debug] [MainThread]: Using postgres connection "master"
[0m13:07:25.407861 [debug] [MainThread]: On master: BEGIN
[0m13:07:25.407861 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:07:25.473456 [debug] [MainThread]: SQL status: BEGIN in 0.077 seconds
[0m13:07:25.473456 [debug] [MainThread]: Using postgres connection "master"
[0m13:07:25.473456 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:07:25.489081 [debug] [MainThread]: SQL status: SELECT 2 in 0.011 seconds
[0m13:07:25.489081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A04CADC10>]}
[0m13:07:25.489081 [debug] [MainThread]: On master: ROLLBACK
[0m13:07:25.489081 [debug] [MainThread]: Using postgres connection "master"
[0m13:07:25.489081 [debug] [MainThread]: On master: BEGIN
[0m13:07:25.504709 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:07:25.504709 [debug] [MainThread]: On master: COMMIT
[0m13:07:25.504709 [debug] [MainThread]: Using postgres connection "master"
[0m13:07:25.504709 [debug] [MainThread]: On master: COMMIT
[0m13:07:25.504709 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:07:25.504709 [debug] [MainThread]: On master: Close
[0m13:07:25.504709 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:07:25.504709 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m13:07:25.520335 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m13:07:25.520335 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m13:07:25.520335 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.520335 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m13:07:25.590539 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.590539 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.598562 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m13:07:25.598562 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:07:25.661387 [debug] [Thread-1 (]: SQL status: BEGIN in 0.065 seconds
[0m13:07:25.661387 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.661387 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m13:07:25.677043 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m13:07:25.677043 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.677043 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m13:07:25.677043 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:07:25.692652 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.692652 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m13:07:25.692652 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:07:25.708277 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:07:25.708277 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.708277 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:07:25.723901 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m13:07:25.723901 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m13:07:25.739527 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:07:25.739527 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m13:07:25.739527 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m13:07:25.739527 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m13:07:25.755152 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A0537CFB0>]}
[0m13:07:25.755152 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m13:07:25.755152 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:07:25.761663 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m13:07:25.761663 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m13:07:25.761663 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m13:07:25.761663 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m13:07:25.761663 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.761663 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m13:07:25.779462 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.779462 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.784481 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m13:07:25.784481 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:07:25.869549 [debug] [Thread-3 (]: SQL status: BEGIN in 0.089 seconds
[0m13:07:25.869549 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.877594 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m13:07:25.877594 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m13:07:25.955735 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.961765 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m13:07:25.961765 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:07:25.961765 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:07:25.961765 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.961765 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:07:25.961765 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m13:07:25.961765 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m13:07:25.961765 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:07:25.961765 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop view if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m13:07:25.961765 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:07:25.977407 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m13:07:25.978938 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A0515E540>]}
[0m13:07:25.978938 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m13:07:25.978938 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m13:07:25.978938 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m13:07:25.978938 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m13:07:25.988049 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m13:07:25.988049 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m13:07:25.992827 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:07:25.992827 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m13:07:26.027895 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:07:26.035990 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:07:26.035990 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m13:07:26.035990 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:07:26.097952 [debug] [Thread-2 (]: SQL status: BEGIN in 0.069 seconds
[0m13:07:26.097952 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:07:26.097952 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
    
        bank_name,
        branch_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by location, bank_name
)

select 
    bank_name,
    branch_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by bank_name,location
  );
  
[0m13:07:26.097952 [debug] [Thread-2 (]: Postgres adapter: Postgres error: ERREUR:  la colonne « int_bank_reviews.branch_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
LINE 18:         branch_name,
                 ^

[0m13:07:26.113579 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: ROLLBACK
[0m13:07:26.113579 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m13:07:26.113579 [debug] [Thread-2 (]: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.branch_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 18:         branch_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:07:26.113579 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c927edf8-8204-4c54-84c9-02a873e4081e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A05626960>]}
[0m13:07:26.113579 [error] [Thread-2 (]: 3 of 3 ERROR creating sql table model public.mart_location_reviews ............. [[31mERROR[0m in 0.13s]
[0m13:07:26.129204 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m13:07:26.129204 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.mart_location_reviews' to be skipped because of status 'error'.  Reason: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.branch_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 18:         branch_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql.
[0m13:07:26.129204 [debug] [MainThread]: Using postgres connection "master"
[0m13:07:26.129204 [debug] [MainThread]: On master: BEGIN
[0m13:07:26.129204 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:07:26.214470 [debug] [MainThread]: SQL status: BEGIN in 0.088 seconds
[0m13:07:26.214470 [debug] [MainThread]: On master: COMMIT
[0m13:07:26.214470 [debug] [MainThread]: Using postgres connection "master"
[0m13:07:26.214470 [debug] [MainThread]: On master: COMMIT
[0m13:07:26.214470 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:07:26.214470 [debug] [MainThread]: On master: Close
[0m13:07:26.214470 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:07:26.214470 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m13:07:26.214470 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m13:07:26.230100 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m13:07:26.230100 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m13:07:26.230100 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m13:07:26.230100 [info ] [MainThread]: 
[0m13:07:26.230100 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.20 seconds (1.20s).
[0m13:07:26.230100 [debug] [MainThread]: Command end result
[0m13:07:26.441407 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:07:26.441407 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:07:26.479889 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m13:07:26.481938 [info ] [MainThread]: 
[0m13:07:26.481938 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:07:26.489993 [info ] [MainThread]: 
[0m13:07:26.492027 [error] [MainThread]:   Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « int_bank_reviews.branch_name » doit apparaître dans la clause GROUP BY ou doit être utilisé dans une fonction d'agrégat
  LINE 18:         branch_name,
                   ^
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:07:26.492027 [info ] [MainThread]: 
[0m13:07:26.492027 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:07:26.500091 [debug] [MainThread]: Command `dbt run` failed at 13:07:26.500091 after 3.24 seconds
[0m13:07:26.500091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A036C74A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A031AB860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029A031ABC80>]}
[0m13:07:26.500091 [debug] [MainThread]: Flushing usage events
[0m13:07:27.331944 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:08:02.317074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018AB99312B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABC7665D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABBB120F0>]}


============================== 13:08:02.332677 | 27d229ba-44d5-4445-9115-98568003481f ==============================
[0m13:08:02.332677 [info ] [MainThread]: Running with dbt=1.9.6
[0m13:08:02.332677 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:08:02.580172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABCA37C80>]}
[0m13:08:02.664846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABC475BE0>]}
[0m13:08:02.664846 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:08:03.065541 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m13:08:03.419870 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:08:03.419870 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\marts\mart_location_reviews.sql
[0m13:08:03.767652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABE3BE1B0>]}
[0m13:08:03.883580 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:08:03.883580 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:08:03.921380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABDF937A0>]}
[0m13:08:03.921380 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m13:08:03.921380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABE015370>]}
[0m13:08:03.921380 [info ] [MainThread]: 
[0m13:08:03.936986 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:03.936986 [info ] [MainThread]: 
[0m13:08:03.940143 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:08:03.948281 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m13:08:04.067986 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m13:08:04.068608 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m13:08:04.068608 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:04.137160 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.082 seconds
[0m13:08:04.152781 [debug] [ThreadPool]: On list_DataWare: Close
[0m13:08:04.152781 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m13:08:04.168405 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:08:04.168405 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m13:08:04.168405 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:04.237458 [debug] [ThreadPool]: SQL status: BEGIN in 0.068 seconds
[0m13:08:04.237458 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:08:04.237458 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:08:04.237458 [debug] [ThreadPool]: SQL status: SELECT 49 in 0.008 seconds
[0m13:08:04.237458 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m13:08:04.253085 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m13:08:04.268705 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:04.268705 [debug] [MainThread]: On master: BEGIN
[0m13:08:04.268705 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:08:04.485011 [debug] [MainThread]: SQL status: BEGIN in 0.212 seconds
[0m13:08:04.485011 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:04.485011 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:08:04.485011 [debug] [MainThread]: SQL status: SELECT 2 in 0.011 seconds
[0m13:08:04.500637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABE716750>]}
[0m13:08:04.500637 [debug] [MainThread]: On master: ROLLBACK
[0m13:08:04.500637 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:04.500637 [debug] [MainThread]: On master: BEGIN
[0m13:08:04.500637 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:08:04.500637 [debug] [MainThread]: On master: COMMIT
[0m13:08:04.507148 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:04.507148 [debug] [MainThread]: On master: COMMIT
[0m13:08:04.507148 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:08:04.507148 [debug] [MainThread]: On master: Close
[0m13:08:04.507148 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:04.507148 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m13:08:04.507148 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m13:08:04.507148 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:04.522807 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.522807 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:04.585609 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.585609 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.585609 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m13:08:04.585609 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:08:04.656588 [debug] [Thread-1 (]: SQL status: BEGIN in 0.070 seconds
[0m13:08:04.656588 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.656588 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m13:08:04.672191 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m13:08:04.672191 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.672191 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m13:08:04.672191 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:08:04.687842 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.687842 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m13:08:04.687842 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:08:04.709497 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:08:04.709497 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.709497 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:08:04.709497 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:08:04.709497 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m13:08:04.725162 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:04.725162 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m13:08:04.725162 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m13:08:04.725162 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m13:08:04.740759 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018AB9A31550>]}
[0m13:08:04.740759 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m13:08:04.740759 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:04.740759 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:04.740759 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m13:08:04.740759 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m13:08:04.740759 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:04.758651 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.758651 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:04.778101 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.778101 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.778101 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m13:08:04.778101 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:08:04.860159 [debug] [Thread-3 (]: SQL status: BEGIN in 0.079 seconds
[0m13:08:04.860159 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.860159 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m13:08:04.868162 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m13:08:04.940807 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.940807 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m13:08:04.940807 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:08:04.940807 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:08:04.940807 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.940807 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:08:04.940807 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m13:08:04.940807 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m13:08:04.956431 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:04.956431 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop view if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m13:08:04.956431 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:08:04.956431 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m13:08:04.956431 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABE7AFC80>]}
[0m13:08:04.956431 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m13:08:04.956431 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:04.956431 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:04.956431 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m13:08:04.969419 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m13:08:04.969419 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:04.977687 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:04.982187 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:05.018482 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:05.018482 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:05.026481 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m13:08:05.026481 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:08:05.091738 [debug] [Thread-2 (]: SQL status: BEGIN in 0.069 seconds
[0m13:08:05.091738 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:05.091738 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
    
        bank_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by location, bank_name
)

select 
    bank_name,
    branch_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by bank_name,location
  );
  
[0m13:08:05.102030 [debug] [Thread-2 (]: Postgres adapter: Postgres error: ERREUR:  la colonne « branch_name » n'existe pas
LINE 33:     branch_name,
             ^
HINT:  Peut-être que vous souhaitiez référencer la colonne « location_reviews.bank_name ».

[0m13:08:05.102030 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: ROLLBACK
[0m13:08:05.102030 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m13:08:05.109542 [debug] [Thread-2 (]: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « branch_name » n'existe pas
  LINE 33:     branch_name,
               ^
  HINT:  Peut-être que vous souhaitiez référencer la colonne « location_reviews.bank_name ».
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:08:05.109542 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27d229ba-44d5-4445-9115-98568003481f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABEB3DA60>]}
[0m13:08:05.117555 [error] [Thread-2 (]: 3 of 3 ERROR creating sql table model public.mart_location_reviews ............. [[31mERROR[0m in 0.15s]
[0m13:08:05.118442 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:05.118442 [debug] [Thread-7 (]: Marking all children of 'model.bank_reviews_analysis.mart_location_reviews' to be skipped because of status 'error'.  Reason: Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « branch_name » n'existe pas
  LINE 33:     branch_name,
               ^
  HINT:  Peut-être que vous souhaitiez référencer la colonne « location_reviews.bank_name ».
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql.
[0m13:08:05.118442 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:05.118442 [debug] [MainThread]: On master: BEGIN
[0m13:08:05.118442 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:08:05.193516 [debug] [MainThread]: SQL status: BEGIN in 0.076 seconds
[0m13:08:05.201499 [debug] [MainThread]: On master: COMMIT
[0m13:08:05.201499 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:05.201499 [debug] [MainThread]: On master: COMMIT
[0m13:08:05.201499 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:08:05.201499 [debug] [MainThread]: On master: Close
[0m13:08:05.201499 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:05.201499 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m13:08:05.201499 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m13:08:05.209553 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m13:08:05.209553 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m13:08:05.209553 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m13:08:05.209553 [info ] [MainThread]: 
[0m13:08:05.209553 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.27 seconds (1.27s).
[0m13:08:05.209553 [debug] [MainThread]: Command end result
[0m13:08:05.270867 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:08:05.270867 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:08:05.285431 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m13:08:05.285431 [info ] [MainThread]: 
[0m13:08:05.285431 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:08:05.285431 [info ] [MainThread]: 
[0m13:08:05.285431 [error] [MainThread]:   Database Error in model mart_location_reviews (models\marts\mart_location_reviews.sql)
  ERREUR:  la colonne « branch_name » n'existe pas
  LINE 33:     branch_name,
               ^
  HINT:  Peut-être que vous souhaitiez référencer la colonne « location_reviews.bank_name ».
  compiled code at target\run\bank_reviews_analysis\models\marts\mart_location_reviews.sql
[0m13:08:05.293437 [info ] [MainThread]: 
[0m13:08:05.293437 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:08:05.300278 [debug] [MainThread]: Command `dbt run` failed at 13:08:05.299361 after 3.12 seconds
[0m13:08:05.300278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABC30BE00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABC308200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018ABCA540E0>]}
[0m13:08:05.304876 [debug] [MainThread]: Flushing usage events
[0m13:08:06.814335 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:08:35.887987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF45230EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF488F92B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4842FD40>]}


============================== 13:08:35.887987 | 22ee840c-c050-4610-8bfd-085a72a49a64 ==============================
[0m13:08:35.887987 [info ] [MainThread]: Running with dbt=1.9.6
[0m13:08:35.887987 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:08:36.141357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF48813380>]}
[0m13:08:36.226049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF487AFD70>]}
[0m13:08:36.226049 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:08:36.630434 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m13:08:36.978171 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:08:36.978171 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://models\marts\mart_location_reviews.sql
[0m13:08:37.326441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4A6DDF70>]}
[0m13:08:37.442372 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:08:37.442372 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:08:37.479169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4A3DB9E0>]}
[0m13:08:37.479169 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m13:08:37.479169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4A0FAF90>]}
[0m13:08:37.479169 [info ] [MainThread]: 
[0m13:08:37.479169 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:37.479169 [info ] [MainThread]: 
[0m13:08:37.495027 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:08:37.504318 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m13:08:37.613118 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m13:08:37.613118 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m13:08:37.628745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:37.711906 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.087 seconds
[0m13:08:37.711906 [debug] [ThreadPool]: On list_DataWare: Close
[0m13:08:37.711906 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m13:08:37.727534 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:08:37.727534 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m13:08:37.727534 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:37.796558 [debug] [ThreadPool]: SQL status: BEGIN in 0.069 seconds
[0m13:08:37.796558 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:08:37.796558 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:08:37.796558 [debug] [ThreadPool]: SQL status: SELECT 49 in 0.008 seconds
[0m13:08:37.812188 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m13:08:37.812188 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m13:08:37.827808 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:37.827808 [debug] [MainThread]: On master: BEGIN
[0m13:08:37.827808 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:08:38.075312 [debug] [MainThread]: SQL status: BEGIN in 0.243 seconds
[0m13:08:38.075312 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:38.075312 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:08:38.081828 [debug] [MainThread]: SQL status: SELECT 2 in 0.013 seconds
[0m13:08:38.098863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4AA274A0>]}
[0m13:08:38.098863 [debug] [MainThread]: On master: ROLLBACK
[0m13:08:38.098863 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:38.098863 [debug] [MainThread]: On master: BEGIN
[0m13:08:38.098863 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:08:38.098863 [debug] [MainThread]: On master: COMMIT
[0m13:08:38.098863 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:38.098863 [debug] [MainThread]: On master: COMMIT
[0m13:08:38.098863 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:08:38.098863 [debug] [MainThread]: On master: Close
[0m13:08:38.114469 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:38.114469 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m13:08:38.122467 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m13:08:38.122467 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:38.141568 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.141568 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:38.334461 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.334461 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.334461 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m13:08:38.342515 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:08:38.453617 [debug] [Thread-1 (]: SQL status: BEGIN in 0.121 seconds
[0m13:08:38.463627 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.463627 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m13:08:38.463627 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m13:08:38.479265 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.479265 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m13:08:38.479265 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:08:38.479265 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.479265 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m13:08:38.479265 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:08:38.510518 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:08:38.510518 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.510518 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:08:38.510518 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m13:08:38.526142 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m13:08:38.526142 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:08:38.526142 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m13:08:38.526142 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m13:08:38.526142 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m13:08:38.541767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF45DA16A0>]}
[0m13:08:38.541767 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.40s]
[0m13:08:38.541767 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:08:38.541767 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:38.541767 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m13:08:38.541767 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m13:08:38.541767 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:38.559557 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.559557 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:38.573257 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.573257 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.573257 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m13:08:38.581259 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:08:38.655593 [debug] [Thread-3 (]: SQL status: BEGIN in 0.082 seconds
[0m13:08:38.655593 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.664270 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z0-9\s]',  -- Remove special characters
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m13:08:38.664270 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m13:08:38.742411 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.742411 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m13:08:38.742411 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:08:38.742411 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:08:38.742411 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.742411 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:08:38.742411 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m13:08:38.742411 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m13:08:38.742411 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:08:38.742411 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop view if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m13:08:38.742411 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:08:38.758019 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m13:08:38.758019 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4AE964E0>]}
[0m13:08:38.758019 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m13:08:38.763528 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m13:08:38.763528 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:38.763528 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m13:08:38.763528 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m13:08:38.769992 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:38.781643 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:38.784473 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:38.814786 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:38.814786 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:38.814786 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m13:08:38.814786 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:08:38.888528 [debug] [Thread-2 (]: SQL status: BEGIN in 0.070 seconds
[0m13:08:38.888528 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:38.888528 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
    
        bank_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by location, bank_name
)

select 
    bank_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by bank_name,location
  );
  
[0m13:08:39.155390 [debug] [Thread-2 (]: SQL status: SELECT 817 in 0.255 seconds
[0m13:08:39.164060 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:39.164060 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
alter table "DataWare"."public"."mart_location_reviews" rename to "mart_location_reviews__dbt_backup"
[0m13:08:39.164060 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:08:39.164060 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:39.164060 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
alter table "DataWare"."public"."mart_location_reviews__dbt_tmp" rename to "mart_location_reviews"
[0m13:08:39.164060 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:08:39.164060 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: COMMIT
[0m13:08:39.164060 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:39.164060 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: COMMIT
[0m13:08:39.179718 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m13:08:39.179718 [debug] [Thread-2 (]: Applying DROP to: "DataWare"."public"."mart_location_reviews__dbt_backup"
[0m13:08:39.179718 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:08:39.179718 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
drop table if exists "DataWare"."public"."mart_location_reviews__dbt_backup" cascade
[0m13:08:39.195325 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m13:08:39.195325 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m13:08:39.195325 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22ee840c-c050-4610-8bfd-085a72a49a64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF4AA5BD40>]}
[0m13:08:39.195325 [info ] [Thread-2 (]: 3 of 3 OK created sql table model public.mart_location_reviews ................. [[32mSELECT 817[0m in 0.43s]
[0m13:08:39.195325 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m13:08:39.195325 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:39.210947 [debug] [MainThread]: On master: BEGIN
[0m13:08:39.210947 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:08:39.427251 [debug] [MainThread]: SQL status: BEGIN in 0.216 seconds
[0m13:08:39.427251 [debug] [MainThread]: On master: COMMIT
[0m13:08:39.427251 [debug] [MainThread]: Using postgres connection "master"
[0m13:08:39.427251 [debug] [MainThread]: On master: COMMIT
[0m13:08:39.427251 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:08:39.427251 [debug] [MainThread]: On master: Close
[0m13:08:39.427251 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:39.427251 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m13:08:39.427251 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m13:08:39.427251 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m13:08:39.427251 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m13:08:39.427251 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m13:08:39.427251 [info ] [MainThread]: 
[0m13:08:39.427251 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.95 seconds (1.95s).
[0m13:08:39.442854 [debug] [MainThread]: Command end result
[0m13:08:39.497330 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:08:39.499727 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:08:39.499727 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m13:08:39.499727 [info ] [MainThread]: 
[0m13:08:39.514015 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:08:39.514015 [info ] [MainThread]: 
[0m13:08:39.514015 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:08:39.522014 [debug] [MainThread]: Command `dbt run` succeeded at 13:08:39.522014 after 3.78 seconds
[0m13:08:39.524535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF46866540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF481D7830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF481D77A0>]}
[0m13:08:39.525286 [debug] [MainThread]: Flushing usage events
[0m13:08:40.599206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:13:12.254557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5038633E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A50043DB50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A50382E690>]}


============================== 13:13:12.270197 | e83082d2-9797-40f7-9314-ab27a4af9346 ==============================
[0m13:13:12.270197 [info ] [MainThread]: Running with dbt=1.9.6
[0m13:13:12.270197 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\Ahmed\\OneDrive\\Bureau\\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\\DBT\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:13:12.525111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A503DF5EB0>]}
[0m13:13:12.608747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A503DC5BB0>]}
[0m13:13:12.608747 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m13:13:12.995504 [debug] [MainThread]: checksum: dd6dc1e5178459e3de3bf2eeb7c86bed4be2266c311fce8c15d86eb4ff94e7ad, vars: {}, profile: , target: , version: 1.9.6
[0m13:13:13.326529 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:13:13.342178 [debug] [MainThread]: Partial parsing: updated file: bank_reviews_analysis://macros\cleaned_text.sql
[0m13:13:13.711876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5056B6E40>]}
[0m13:13:13.812122 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:13:13.827749 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:13:13.858997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A50541A120>]}
[0m13:13:13.858997 [info ] [MainThread]: Found 3 models, 1 source, 846 macros
[0m13:13:13.858997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A505706210>]}
[0m13:13:13.874622 [info ] [MainThread]: 
[0m13:13:13.874622 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:13:13.874622 [info ] [MainThread]: 
[0m13:13:13.878573 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:13:13.885121 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare'
[0m13:13:14.011056 [debug] [ThreadPool]: Using postgres connection "list_DataWare"
[0m13:13:14.012125 [debug] [ThreadPool]: On list_DataWare: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare"} */

    select distinct nspname from pg_namespace
  
[0m13:13:14.012125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:13:14.082306 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.073 seconds
[0m13:13:14.082306 [debug] [ThreadPool]: On list_DataWare: Close
[0m13:13:14.082306 [debug] [ThreadPool]: Acquiring new postgres connection 'list_DataWare_public'
[0m13:13:14.097948 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:13:14.097948 [debug] [ThreadPool]: On list_DataWare_public: BEGIN
[0m13:13:14.097948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:13:14.160441 [debug] [ThreadPool]: SQL status: BEGIN in 0.069 seconds
[0m13:13:14.160441 [debug] [ThreadPool]: Using postgres connection "list_DataWare_public"
[0m13:13:14.160441 [debug] [ThreadPool]: On list_DataWare_public: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "list_DataWare_public"} */
select
      'DataWare' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'DataWare' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:13:14.176072 [debug] [ThreadPool]: SQL status: SELECT 49 in 0.008 seconds
[0m13:13:14.182590 [debug] [ThreadPool]: On list_DataWare_public: ROLLBACK
[0m13:13:14.182590 [debug] [ThreadPool]: On list_DataWare_public: Close
[0m13:13:14.198251 [debug] [MainThread]: Using postgres connection "master"
[0m13:13:14.198251 [debug] [MainThread]: On master: BEGIN
[0m13:13:14.198251 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:13:14.260750 [debug] [MainThread]: SQL status: BEGIN in 0.064 seconds
[0m13:13:14.260750 [debug] [MainThread]: Using postgres connection "master"
[0m13:13:14.260750 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:13:14.282895 [debug] [MainThread]: SQL status: SELECT 2 in 0.011 seconds
[0m13:13:14.282895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A503DC74D0>]}
[0m13:13:14.282895 [debug] [MainThread]: On master: ROLLBACK
[0m13:13:14.282895 [debug] [MainThread]: Using postgres connection "master"
[0m13:13:14.282895 [debug] [MainThread]: On master: BEGIN
[0m13:13:14.282895 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:13:14.282895 [debug] [MainThread]: On master: COMMIT
[0m13:13:14.282895 [debug] [MainThread]: Using postgres connection "master"
[0m13:13:14.282895 [debug] [MainThread]: On master: COMMIT
[0m13:13:14.282895 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:13:14.282895 [debug] [MainThread]: On master: Close
[0m13:13:14.298533 [debug] [Thread-1 (]: Began running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:13:14.298533 [info ] [Thread-1 (]: 1 of 3 START sql view model public.stg_bank_reviews ............................ [RUN]
[0m13:13:14.298533 [debug] [Thread-1 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.stg_bank_reviews'
[0m13:13:14.298533 [debug] [Thread-1 (]: Began compiling node model.bank_reviews_analysis.stg_bank_reviews
[0m13:13:14.298533 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.316078 [debug] [Thread-1 (]: Began executing node model.bank_reviews_analysis.stg_bank_reviews
[0m13:13:14.378709 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.383218 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.383218 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: BEGIN
[0m13:13:14.383218 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:13:14.445732 [debug] [Thread-1 (]: SQL status: BEGIN in 0.064 seconds
[0m13:13:14.445732 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.445732 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */

  create view "DataWare"."public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    

with source as (
    select * from "DataWare"."public"."bank_reviews"
),

-- Remove duplicates based on all columns
deduplicated as (
    select distinct
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        rating,
        review_date,
        created_at
    from source
),

-- Handle missing values
cleaned as (
    select
        id,
        coalesce(bank_name, 'Unknown Bank') as bank_name,
        coalesce(branch_name, 'Unknown Branch') as branch_name,
        coalesce(location, 'Unknown Location') as location,
        coalesce(review_text, '') as review_text,
        coalesce(rating, 3) as rating,  -- Default to neutral rating
        coalesce(review_date, current_date) as review_date,
        coalesce(created_at, current_timestamp) as created_at
    from deduplicated
)

select * from cleaned
  );
[0m13:13:14.445732 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m13:13:14.461364 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.461364 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m13:13:14.461364 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:13:14.476985 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.476985 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
alter table "DataWare"."public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m13:13:14.476985 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:13:14.499143 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:13:14.499143 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.499143 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: COMMIT
[0m13:13:14.499143 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m13:13:14.514772 [debug] [Thread-1 (]: Applying DROP to: "DataWare"."public"."stg_bank_reviews__dbt_backup"
[0m13:13:14.514772 [debug] [Thread-1 (]: Using postgres connection "model.bank_reviews_analysis.stg_bank_reviews"
[0m13:13:14.514772 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.stg_bank_reviews"} */
drop view if exists "DataWare"."public"."stg_bank_reviews__dbt_backup" cascade
[0m13:13:14.514772 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m13:13:14.514772 [debug] [Thread-1 (]: On model.bank_reviews_analysis.stg_bank_reviews: Close
[0m13:13:14.530395 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A500E21790>]}
[0m13:13:14.530395 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public.stg_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.22s]
[0m13:13:14.530395 [debug] [Thread-1 (]: Finished running node model.bank_reviews_analysis.stg_bank_reviews
[0m13:13:14.530395 [debug] [Thread-3 (]: Began running node model.bank_reviews_analysis.int_bank_reviews
[0m13:13:14.530395 [info ] [Thread-3 (]: 2 of 3 START sql view model public.int_bank_reviews ............................ [RUN]
[0m13:13:14.540107 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.int_bank_reviews'
[0m13:13:14.541116 [debug] [Thread-3 (]: Began compiling node model.bank_reviews_analysis.int_bank_reviews
[0m13:13:14.551333 [debug] [Thread-3 (]: Writing injected SQL for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.551488 [debug] [Thread-3 (]: Began executing node model.bank_reviews_analysis.int_bank_reviews
[0m13:13:14.661075 [debug] [Thread-3 (]: Writing runtime sql for node "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.661075 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.661075 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: BEGIN
[0m13:13:14.661075 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:13:14.761850 [debug] [Thread-3 (]: SQL status: BEGIN in 0.091 seconds
[0m13:13:14.761850 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.761850 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */

  create view "DataWare"."public"."int_bank_reviews__dbt_tmp"
    
    
  as (
    /*
This model transforms bank review data by:
1. Normalizing text fields (lowercase, removing special characters, trimming whitespace)
2. Adding sentiment analysis based on rating scores
3. Extracting temporal components (year, month) for time-based analysis
4. Calculating review age in days

The model follows these steps:
- Starts with cleaned staging data (stg_bank_reviews)
- Applies text cleaning using the cleaned_text macro
- Adds derived fields for analysis
- Materializes as a table for better query performance
*/



with stg_reviews as (
    select * from "DataWare"."public"."stg_bank_reviews"
),

text_normalized as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        
    -- Convert to lowercase, remove special characters and numbers, clean whitespace
    trim(
        regexp_replace(
            regexp_replace(
                lower(coalesce(review_text, '')),
                '[^a-z\s]',  -- Remove special characters and numbers, keep only letters and spaces
                '',
                'g'
            ),
            '\s+',  -- Clean whitespace
            ' ',
            'g'
        )
    )
 as cleaned_text,
        rating,
        review_date,
        created_at
    from stg_reviews
),

transformed as (
    select
        id,
        bank_name,
        branch_name,
        location,
        review_text,
        cleaned_text,
        rating,
        review_date,
        created_at,
        -- Add some useful transformations
        case 
            when rating >= 4 then 'Positive'
            when rating = 3 then 'Neutral'
            else 'Negative'
        end as sentiment,
        -- Extract year and month for easier analysis
        extract(year from review_date) as review_year,
        extract(month from review_date) as review_month,
        -- Calculate days since review
        current_date - review_date as days_since_review
    from text_normalized
)

select * from transformed
  );
[0m13:13:14.761850 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m13:13:14.783991 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.783991 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
alter table "DataWare"."public"."int_bank_reviews__dbt_tmp" rename to "int_bank_reviews"
[0m13:13:14.783991 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:13:14.783991 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:13:14.783991 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.783991 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: COMMIT
[0m13:13:14.783991 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m13:13:14.799631 [debug] [Thread-3 (]: Applying DROP to: "DataWare"."public"."int_bank_reviews__dbt_backup"
[0m13:13:14.799631 [debug] [Thread-3 (]: Using postgres connection "model.bank_reviews_analysis.int_bank_reviews"
[0m13:13:14.799631 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.int_bank_reviews"} */
drop view if exists "DataWare"."public"."int_bank_reviews__dbt_backup" cascade
[0m13:13:14.799631 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:13:14.799631 [debug] [Thread-3 (]: On model.bank_reviews_analysis.int_bank_reviews: Close
[0m13:13:14.799631 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A505A4BFB0>]}
[0m13:13:14.799631 [info ] [Thread-3 (]: 2 of 3 OK created sql view model public.int_bank_reviews ....................... [[32mCREATE VIEW[0m in 0.27s]
[0m13:13:14.799631 [debug] [Thread-3 (]: Finished running node model.bank_reviews_analysis.int_bank_reviews
[0m13:13:14.815255 [debug] [Thread-2 (]: Began running node model.bank_reviews_analysis.mart_location_reviews
[0m13:13:14.815255 [info ] [Thread-2 (]: 3 of 3 START sql table model public.mart_location_reviews ...................... [RUN]
[0m13:13:14.820186 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.bank_reviews_analysis.mart_location_reviews'
[0m13:13:14.821183 [debug] [Thread-2 (]: Began compiling node model.bank_reviews_analysis.mart_location_reviews
[0m13:13:14.832391 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:14.836932 [debug] [Thread-2 (]: Began executing node model.bank_reviews_analysis.mart_location_reviews
[0m13:13:14.884173 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:14.884173 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:14.884173 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: BEGIN
[0m13:13:14.884173 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:13:15.077897 [debug] [Thread-2 (]: SQL status: BEGIN in 0.189 seconds
[0m13:13:15.077897 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:15.084410 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */

  
    

  create  table "DataWare"."public"."mart_location_reviews__dbt_tmp"
  
  
    as
  
  (
    

with location_reviews as (
    select 
    
        bank_name,
        location,
        string_agg(cleaned_text, ' ') as concatenated_text,
        count(*) as review_count,
        round(avg(rating)::numeric, 2) as avg_rating,
        min(rating) as min_rating,
        max(rating) as max_rating,
        count(case when rating >= 4 then 1 end) as positive_reviews,
        count(case when rating <= 2 then 1 end) as negative_reviews
    from "DataWare"."public"."int_bank_reviews"
    where cleaned_text is not null
    group by location, bank_name
)

select 
    bank_name,
    location,
    concatenated_text,
    review_count,
    avg_rating,
    min_rating,
    max_rating,
    positive_reviews,
    negative_reviews,
    round((positive_reviews::float / review_count * 100)::numeric, 2) as positive_review_percentage,
    round((negative_reviews::float / review_count * 100)::numeric, 2) as negative_review_percentage
from location_reviews
order by bank_name,location
  );
  
[0m13:13:15.331455 [debug] [Thread-2 (]: SQL status: SELECT 817 in 0.256 seconds
[0m13:13:15.347079 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:15.347079 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
alter table "DataWare"."public"."mart_location_reviews" rename to "mart_location_reviews__dbt_backup"
[0m13:13:15.347079 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:13:15.347079 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:15.347079 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
alter table "DataWare"."public"."mart_location_reviews__dbt_tmp" rename to "mart_location_reviews"
[0m13:13:15.362697 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:13:15.362697 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: COMMIT
[0m13:13:15.362697 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:15.362697 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: COMMIT
[0m13:13:15.362697 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m13:13:15.362697 [debug] [Thread-2 (]: Applying DROP to: "DataWare"."public"."mart_location_reviews__dbt_backup"
[0m13:13:15.378330 [debug] [Thread-2 (]: Using postgres connection "model.bank_reviews_analysis.mart_location_reviews"
[0m13:13:15.378330 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: /* {"app": "dbt", "dbt_version": "1.9.6", "profile_name": "bank_reviews", "target_name": "dev", "node_id": "model.bank_reviews_analysis.mart_location_reviews"} */
drop table if exists "DataWare"."public"."mart_location_reviews__dbt_backup" cascade
[0m13:13:15.384847 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m13:13:15.384847 [debug] [Thread-2 (]: On model.bank_reviews_analysis.mart_location_reviews: Close
[0m13:13:15.384847 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e83082d2-9797-40f7-9314-ab27a4af9346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5057D4560>]}
[0m13:13:15.384847 [info ] [Thread-2 (]: 3 of 3 OK created sql table model public.mart_location_reviews ................. [[32mSELECT 817[0m in 0.57s]
[0m13:13:15.384847 [debug] [Thread-2 (]: Finished running node model.bank_reviews_analysis.mart_location_reviews
[0m13:13:15.384847 [debug] [MainThread]: Using postgres connection "master"
[0m13:13:15.384847 [debug] [MainThread]: On master: BEGIN
[0m13:13:15.384847 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:13:15.461847 [debug] [MainThread]: SQL status: BEGIN in 0.077 seconds
[0m13:13:15.461847 [debug] [MainThread]: On master: COMMIT
[0m13:13:15.461847 [debug] [MainThread]: Using postgres connection "master"
[0m13:13:15.461847 [debug] [MainThread]: On master: COMMIT
[0m13:13:15.461847 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:13:15.461847 [debug] [MainThread]: On master: Close
[0m13:13:15.477479 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:13:15.477479 [debug] [MainThread]: Connection 'list_DataWare' was properly closed.
[0m13:13:15.477479 [debug] [MainThread]: Connection 'list_DataWare_public' was properly closed.
[0m13:13:15.477479 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.stg_bank_reviews' was properly closed.
[0m13:13:15.477479 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.int_bank_reviews' was properly closed.
[0m13:13:15.477479 [debug] [MainThread]: Connection 'model.bank_reviews_analysis.mart_location_reviews' was properly closed.
[0m13:13:15.477479 [info ] [MainThread]: 
[0m13:13:15.477479 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 1.60 seconds (1.60s).
[0m13:13:15.484994 [debug] [MainThread]: Command end result
[0m13:13:15.546979 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\manifest.json
[0m13:13:15.546979 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\semantic_manifest.json
[0m13:13:15.566167 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\Ahmed\OneDrive\Bureau\Analyzing-Customer-Reviews-of-Bank-Agencies-in-Morocco\DBT\target\run_results.json
[0m13:13:15.567167 [info ] [MainThread]: 
[0m13:13:15.568167 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:13:15.569169 [info ] [MainThread]: 
[0m13:13:15.570171 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:13:15.572282 [debug] [MainThread]: Command `dbt run` succeeded at 13:13:15.572282 after 3.46 seconds
[0m13:13:15.573264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A503BEBC20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A503896120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5056B6DE0>]}
[0m13:13:15.573264 [debug] [MainThread]: Flushing usage events
[0m13:13:16.365589 [debug] [MainThread]: An error was encountered while trying to flush usage events
